---
phase: "03-ui-shell"
plan: "03-01"
type: "feature"
wave: 1
depends_on: []
files_modified:
  - "public/css/layout.css"
  - "public/css/status-colors.css"
  - "src/views/partials/head.ejs"
  - "src/views/partials/header.ejs"
  - "src/views/partials/footer.ejs"
  - "src/views/partials/sidebar.ejs"
  - "src/views/partials/layout-top.ejs"
  - "src/views/partials/layout-bottom.ejs"
autonomous: true
discovery: 0
must_haves:
  truths:
    - "layout-top.ejs and layout-bottom.ejs provide a DRY wrapper that includes head, header, sidebar, footer"
    - "Sidebar contains four navigation links: Dashboard (/), Phases (/phases), Todos (/todos), Roadmap (/roadmap)"
    - "Active page is indicated via aria-current=page attribute on the current nav link"
    - "CSS Grid positions header, sidebar, content area, and footer in a dashboard layout"
    - "Status color CSS defines green/yellow/red/gray via data-status attribute selectors"
    - "Status badges pair color with text labels for accessibility"
  artifacts:
    - "public/css/layout.css with CSS Grid layout and active nav styling"
    - "public/css/status-colors.css with data-status color rules and status-badge styles"
    - "src/views/partials/layout-top.ejs containing DOCTYPE through opening <main>"
    - "src/views/partials/layout-bottom.ejs containing closing </main> through </html>"
    - "src/views/partials/sidebar.ejs with nav links and activePage conditional"
    - "src/views/partials/head.ejs updated with custom CSS links"
    - "src/views/partials/header.ejs updated for grid layout (no container class)"
    - "src/views/partials/footer.ejs updated for grid layout (no container class)"
  key_links:
    - "layout-top.ejs includes head.ejs, header.ejs, and sidebar.ejs"
    - "layout-bottom.ejs includes footer.ejs"
    - "head.ejs links to layout.css and status-colors.css from public/css/"
    - "sidebar.ejs reads activePage variable to set aria-current on the correct link"
provides:
  - "layout-top.ejs and layout-bottom.ejs partials for all page templates"
  - "Sidebar navigation partial with activePage highlighting"
  - "CSS Grid dashboard layout"
  - "Status color system via data-status attributes"
---

# Plan 03-01: Layout Infrastructure, Sidebar, and CSS

## Overview

Create the foundational layout system for the Towline Dashboard. This plan builds
the CSS Grid layout, the sidebar navigation partial, status color CSS, and the
layout-top/layout-bottom wrapper partials. It also updates the existing head,
header, and footer partials from Phase 01 to work within the new grid structure.

After this plan, the layout infrastructure is ready but no page templates have been
updated yet -- that happens in Plan 03-02.

## Tasks

<task id="03-01-T1" type="auto">
  <name>Create CSS files for grid layout and status colors</name>
  <files>
    public/css/layout.css
    public/css/status-colors.css
  </files>
  <action>
    All file paths are relative to `D:\Repos\towline-test-project`.

    1. Create directory `public/css/` if it does not exist.

    2. Create `public/css/layout.css` with the CSS Grid layout structure:
       ```css
       /* Dashboard grid layout */
       .page-wrapper {
         display: grid;
         gap: 0;
         grid-template-columns: 250px 1fr;
         grid-template-rows: auto 1fr auto;
         grid-template-areas:
           "header  header"
           "sidebar content"
           "footer  footer";
         min-height: 100vh;
       }

       .page-wrapper > header {
         grid-area: header;
         padding: 1rem 2rem;
         border-bottom: 1px solid var(--pico-muted-border-color);
       }

       .page-wrapper > aside.sidebar {
         grid-area: sidebar;
         padding: 1rem;
         border-right: 1px solid var(--pico-muted-border-color);
       }

       .page-wrapper > main {
         grid-area: content;
         padding: 2rem;
         overflow-y: auto;
       }

       .page-wrapper > footer {
         grid-area: footer;
         padding: 1rem 2rem;
         border-top: 1px solid var(--pico-muted-border-color);
       }

       /* Sidebar navigation styling */
       aside.sidebar nav ul {
         list-style: none;
         padding: 0;
         margin: 0;
       }

       aside.sidebar nav li {
         margin: 0;
         padding: 0;
       }

       aside.sidebar nav a {
         display: block;
         padding: 0.5rem 1rem;
         text-decoration: none;
         border-left: 3px solid transparent;
         border-radius: 0;
       }

       aside.sidebar nav a[aria-current="page"] {
         font-weight: bold;
         border-left-color: var(--pico-primary);
         background-color: var(--pico-primary-focus);
       }

       /* Header nav layout */
       .page-wrapper > header nav {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin: 0;
         padding: 0;
       }

       .page-wrapper > header nav ul {
         list-style: none;
         margin: 0;
         padding: 0;
       }
       ```

       Key points:
       - CSS Grid with grid-template-areas for clear layout structure
       - 250px fixed sidebar, 1fr flexible content area
       - Uses Pico.css CSS custom properties (--pico-muted-border-color, --pico-primary) for theming
       - aria-current="page" selector for active nav highlighting
       - NO responsive/mobile media queries (deferred -- responsive/mobile is out of scope)

    3. Create `public/css/status-colors.css` with the status color system:
       ```css
       /* Status color definitions */
       :root {
         --status-complete: #22c55e;
         --status-in-progress: #eab308;
         --status-blocked: #ef4444;
         --status-not-started: #9ca3af;
       }

       /* Text color by status */
       [data-status="complete"] {
         color: var(--status-complete);
       }

       [data-status="in-progress"] {
         color: var(--status-in-progress);
       }

       [data-status="blocked"],
       [data-status="failed"] {
         color: var(--status-blocked);
       }

       [data-status="not-started"],
       [data-status="pending"] {
         color: var(--status-not-started);
       }

       /* Status badge: background + text, includes text label for accessibility */
       .status-badge {
         display: inline-block;
         padding: 0.2rem 0.6rem;
         border-radius: 0.25rem;
         font-size: 0.85rem;
         font-weight: 600;
         line-height: 1.4;
       }

       .status-badge[data-status="complete"] {
         background-color: #dcfce7;
         color: #14532d;
       }

       .status-badge[data-status="in-progress"] {
         background-color: #fef9c3;
         color: #713f12;
       }

       .status-badge[data-status="blocked"],
       .status-badge[data-status="failed"] {
         background-color: #fee2e2;
         color: #7f1d1d;
       }

       .status-badge[data-status="not-started"],
       .status-badge[data-status="pending"] {
         background-color: #f3f4f6;
         color: #111827;
       }
       ```

       Key points:
       - Uses hardcoded color values (Pico.css v2 does not expose --pico-color-green-500 etc.)
       - data-status attribute selectors for clean HTML integration
       - .status-badge class provides background+text color combination
       - "pending" is an alias for "not-started" (common in Towline frontmatter)
       - Status badges always include text content -- color is NOT the sole indicator
  </action>
  <verify>
    node -e "const fs = require('fs'); const l = fs.readFileSync('D:/Repos/towline-test-project/public/css/layout.css', 'utf8'); const s = fs.readFileSync('D:/Repos/towline-test-project/public/css/status-colors.css', 'utf8'); if (!l.includes('grid-template-areas')) throw new Error('layout.css missing grid'); if (!s.includes('data-status')) throw new Error('status-colors.css missing data-status'); console.log('PASS: both CSS files exist with expected content');"
  </verify>
  <done>CSS Grid layout file and status color CSS file exist in public/css/, providing the visual foundation for dashboard layout and status indicators</done>
</task>

<task id="03-01-T2" type="auto">
  <name>Create layout partials and update existing partials for grid structure</name>
  <files>
    src/views/partials/head.ejs
    src/views/partials/header.ejs
    src/views/partials/footer.ejs
    src/views/partials/sidebar.ejs
    src/views/partials/layout-top.ejs
    src/views/partials/layout-bottom.ejs
  </files>
  <action>
    All file paths are relative to `D:\Repos\towline-test-project`.

    1. Update `src/views/partials/head.ejs` to add custom CSS links after Pico.css:
       ```html
       <head>
         <meta charset="UTF-8">
         <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <title><%= typeof title !== 'undefined' ? title : 'Towline' %> - Towline</title>
         <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
         <link rel="stylesheet" href="/css/layout.css">
         <link rel="stylesheet" href="/css/status-colors.css">
       </head>
       ```

       Key change: Two new `<link>` tags for the custom CSS files created in the previous task.
       These use absolute paths (/css/...) which are served by express.static from public/.

    2. Update `src/views/partials/header.ejs` -- remove the `container` class since the
       grid layout now controls width. Keep the nav structure but simplify for grid context:
       ```html
       <header>
         <nav>
           <ul>
             <li><strong>Towline Dashboard</strong></li>
           </ul>
         </nav>
       </header>
       ```

       Key changes:
       - Removed `class="container"` (grid handles positioning, not Pico.css container)
       - Removed the Dashboard link from header (it is now in the sidebar)
       - Header is purely branding now

    3. Update `src/views/partials/footer.ejs` -- remove the `container` class:
       ```html
       <footer>
         <small>Towline Dashboard v0.1.0</small>
       </footer>
       ```

       Key change: Removed `class="container"` (grid handles positioning).

    4. Create `src/views/partials/sidebar.ejs` -- sidebar navigation with activePage support:
       ```html
       <aside class="sidebar">
         <nav>
           <ul>
             <li>
               <a href="/"<%= typeof activePage !== 'undefined' && activePage === 'dashboard' ? ' aria-current="page"' : '' %>>
                 Dashboard
               </a>
             </li>
             <li>
               <a href="/phases"<%= typeof activePage !== 'undefined' && activePage === 'phases' ? ' aria-current="page"' : '' %>>
                 Phases
               </a>
             </li>
             <li>
               <a href="/todos"<%= typeof activePage !== 'undefined' && activePage === 'todos' ? ' aria-current="page"' : '' %>>
                 Todos
               </a>
             </li>
             <li>
               <a href="/roadmap"<%= typeof activePage !== 'undefined' && activePage === 'roadmap' ? ' aria-current="page"' : '' %>>
                 Roadmap
               </a>
             </li>
           </ul>
         </nav>
       </aside>
       ```

       Key points:
       - Uses `typeof activePage !== 'undefined'` as a defensive check to avoid ReferenceError
       - Adds `aria-current="page"` attribute only to the active link (accessibility best practice)
       - Four navigation links: Dashboard, Phases, Todos, Roadmap
       - Links use standard hrefs (full page navigation, no HTMX yet)

    5. Create `src/views/partials/layout-top.ejs` -- the top half of the layout wrapper:
       ```html
       <!DOCTYPE html>
       <html lang="en">
       <%- include('head', { title: typeof title !== 'undefined' ? title : 'Towline Dashboard' }) %>
       <body>
         <div class="page-wrapper">
           <%- include('header') %>
           <%- include('sidebar', { activePage: typeof activePage !== 'undefined' ? activePage : '' }) %>
           <main>
       ```

       Key points:
       - Includes head.ejs, header.ejs, and sidebar.ejs
       - Opens the `<div class="page-wrapper">` for CSS Grid
       - Opens `<main>` tag (content goes between layout-top and layout-bottom)
       - Explicitly passes title and activePage to sub-partials
       - `typeof` guards prevent ReferenceError if variables are not passed

    6. Create `src/views/partials/layout-bottom.ejs` -- the bottom half of the layout wrapper:
       ```html
           </main>
           <%- include('footer') %>
         </div>
       </body>
       </html>
       ```

       Key points:
       - Closes `</main>`, includes footer, closes the page-wrapper div
       - Closes `</body>` and `</html>`
       - No variables needed -- footer.ejs currently has no dynamic content

    7. Delete `src/views/layout.ejs` -- the Phase 01 reference-only file. It is replaced
       by the actual layout-top.ejs and layout-bottom.ejs partials. If deletion is not
       possible in the executor environment, replace its contents with a comment pointing
       to the new partials:
       ```html
       <%# This file is deprecated. See partials/layout-top.ejs and partials/layout-bottom.ejs %>
       ```
  </action>
  <verify>
    node -e "const fs = require('fs'); const files = ['layout-top.ejs','layout-bottom.ejs','sidebar.ejs','head.ejs','header.ejs','footer.ejs']; for (const f of files) { const p = 'D:/Repos/towline-test-project/src/views/partials/' + f; if (!fs.existsSync(p)) throw new Error('Missing: ' + f); } const lt = fs.readFileSync('D:/Repos/towline-test-project/src/views/partials/layout-top.ejs','utf8'); if (!lt.includes('page-wrapper')) throw new Error('layout-top missing page-wrapper'); if (!lt.includes('sidebar')) throw new Error('layout-top missing sidebar include'); const sb = fs.readFileSync('D:/Repos/towline-test-project/src/views/partials/sidebar.ejs','utf8'); if (!sb.includes('aria-current')) throw new Error('sidebar missing aria-current'); if (!sb.includes('/phases')) throw new Error('sidebar missing /phases link'); if (!sb.includes('/todos')) throw new Error('sidebar missing /todos link'); if (!sb.includes('/roadmap')) throw new Error('sidebar missing /roadmap link'); const hd = fs.readFileSync('D:/Repos/towline-test-project/src/views/partials/head.ejs','utf8'); if (!hd.includes('layout.css')) throw new Error('head missing layout.css link'); if (!hd.includes('status-colors.css')) throw new Error('head missing status-colors.css link'); console.log('PASS: all 6 partials exist with expected content');"
  </verify>
  <done>Layout-top and layout-bottom partials exist and include head, header, sidebar, and footer; sidebar contains all four navigation links with aria-current support; head.ejs links to custom CSS files</done>
</task>
