---
phase: "16-config-routing-upgrades"
plan: "16-01"
type: "feature"
wave: 1
depends_on: []
files_modified:
  - "plugins/dev/skills/shared/gate-prompts.md"
  - "plugins/dev/skills/config/SKILL.md"
autonomous: true
dependency_fingerprints:
  "15-01": "len:4037-mod:2026-02-10T20:26"
  "15-02": "len:4079-mod:2026-02-10T20:26"
discovery: 0
must_haves:
  truths:
    - "gate-prompts.md contains 6 new patterns for config, status, resume, and quick skills"
    - "/dev:config category selection uses AskUserQuestion with 4 primary options"
    - "/dev:config toggle and model profile changes use AskUserQuestion"
  artifacts:
    - "plugins/dev/skills/shared/gate-prompts.md (updated with 6 new patterns)"
    - "plugins/dev/skills/config/SKILL.md (converted to AskUserQuestion)"
  key_links:
    - "config SKILL.md references settings-category-select pattern from gate-prompts.md"
    - "config SKILL.md references toggle-confirm pattern from gate-prompts.md"
    - "config SKILL.md references model-profile-select pattern from gate-prompts.md"
---

# Plan 16-01: Add Gate Prompt Patterns + Convert Config Skill

## Goal

Extend `gate-prompts.md` with 6 new reusable AskUserQuestion patterns for settings menus and routing decisions, then convert the config skill's interactive menus from freeform text to structured AskUserQuestion prompts.

## Context

Phase 15 established 8 gate check patterns in `gate-prompts.md` for approve/deny decisions. Phase 16 extends this to settings configuration and workflow routing. The config skill has the most complex conversion: a 7-option category menu that must be condensed to 4 primary options (AskUserQuestion max), plus follow-up AskUserQuestion prompts for toggles and model selection.

---

<task id="16-01-T1" type="auto" tdd="false">
  <name>Append 6 new AskUserQuestion patterns to gate-prompts.md</name>
  <files>
    plugins/dev/skills/shared/gate-prompts.md
  </files>
  <action>
1. Read `plugins/dev/skills/shared/gate-prompts.md` to confirm current content (8 patterns ending with multi-option-priority)
2. Update the `> Referenced by:` line at the top to include the new skills: change from `plan, build, import, scan, review, milestone skills` to `plan, build, import, scan, review, milestone, config, status, resume, quick skills`
3. Append the following 6 new pattern sections after the existing `multi-option-priority` pattern, maintaining the same formatting style (## heading, description, code block with AskUserQuestion, optional Note):

**Pattern: settings-category-select**
- Purpose: 4-option menu for configuration category selection (config skill)
- question: "What would you like to configure?"
- header: "Configure"
- options:
  - label: "Depth" / description: "quick/standard/comprehensive"
  - label: "Model profile" / description: "quality/balanced/budget/adaptive"
  - label: "Features" / description: "Toggle workflow features and gates"
  - label: "Git settings" / description: "branching strategy, commit mode"
- multiSelect: false
- Note: Original 7 categories condensed to 4. "Models" (per-agent) merged into "Model profile". "Gates" and "Parallelization" merged into "Features". After selection, show a category-specific follow-up AskUserQuestion.

**Pattern: toggle-confirm**
- Purpose: 2-option confirmation for enabling/disabling boolean features (config skill)
- question: "Enable {feature_name}?"
- header: "Toggle"
- options:
  - label: "Enable" / description: "Turn this feature on"
  - label: "Disable" / description: "Turn this feature off"
- multiSelect: false

**Pattern: model-profile-select**
- Purpose: 4-option selection for model profile presets (config skill)
- question: "Select model profile"
- header: "Profile"
- options:
  - label: "Quality" / description: "opus for all agents (highest cost)"
  - label: "Balanced" / description: "sonnet/inherit mix (default)"
  - label: "Budget" / description: "haiku for all agents (lowest cost)"
  - label: "Adaptive" / description: "sonnet planning, haiku execution"
- multiSelect: false

**Pattern: action-routing**
- Purpose: Up to 4 suggested next actions with selection (status, resume skills)
- question: "What would you like to do next?"
- header: "Next Step"
- options:
  - label: "{primary action}" / description: "{explanation}"
  - label: "{alternative 1}" / description: "{explanation}"
  - label: "{alternative 2}" / description: "{explanation}"
  - label: "Something else" / description: "Enter a different command"
- multiSelect: false
- Note: Dynamically generate options from workflow state. The "Something else" option allows freeform input. Build 1-3 real options + always include "Something else" as the last option. If only 1 real option exists, use the yes-no pattern instead.

**Pattern: pause-point-select**
- Purpose: Select from multiple resume points (resume skill)
- question: "Found multiple pause points. Which would you like to resume?"
- header: "Resume"
- options:
  - label: "Phase {A}" / description: "Paused {date}"
  - label: "Phase {B}" / description: "Paused {date}"
  - label: "Phase {C}" / description: "Paused {date}"
  - label: "Phase {D}" / description: "Paused {date}"
- multiSelect: false
- Note: If more than 4 pause points exist, show the 4 most recent. The oldest option becomes "Show earlier" which re-prompts with the next batch.

**Pattern: scope-confirm**
- Purpose: 3-option confirmation for quick task scope validation (quick skill)
- question: "This task looks complex. Proceed as quick task or use full planning?"
- header: "Scope"
- options:
  - label: "Quick task" / description: "Execute as lightweight task"
  - label: "Full plan" / description: "Switch to /dev:plan for proper planning"
  - label: "Revise" / description: "Let me rewrite the task description"
- multiSelect: false

4. Verify all headers are <= 12 characters: "Configure" (9), "Toggle" (6), "Profile" (7), "Next Step" (9), "Resume" (6), "Scope" (5) -- all pass
5. Verify all options have <= 4 entries per pattern -- all pass
  </action>
  <verify>
node -e "const fs = require('fs'); const c = fs.readFileSync('plugins/dev/skills/shared/gate-prompts.md', 'utf8'); const patterns = c.match(/## Pattern: /g); console.log('Pattern count:', patterns.length); const headers = c.match(/header: \"([^\"]+)\"/g); headers.forEach(h => { const val = h.match(/\"([^\"]+)\"/)[1]; console.log('Header:', val, '(' + val.length + ' chars)', val.length <= 12 ? 'OK' : 'FAIL'); });"
  </verify>
  <done>gate-prompts.md contains 14 total patterns (8 existing + 6 new), all headers <= 12 characters, all patterns have <= 4 options</done>
</task>

<task id="16-01-T2" type="auto" tdd="false">
  <name>Convert config SKILL.md interactive menus to AskUserQuestion</name>
  <files>
    plugins/dev/skills/config/SKILL.md
  </files>
  <action>
1. Read `plugins/dev/skills/config/SKILL.md` to confirm current content
2. In the `allowed-tools` frontmatter, add `AskUserQuestion` to the list. Change from `Read, Write, Bash, Glob` to `Read, Write, Bash, Glob, AskUserQuestion`
3. Replace Step 3 "Interactive Mode" section (lines 72-79). The current text reads:

```
Then ask: "What would you like to change?" with options:
- Depth (quick/standard/comprehensive)
- Models (per-agent model selection)
- Model profile (quality/balanced/budget/adaptive â€” sets all models at once)
- Features (toggle individual features)
- Gates (toggle confirmation gates)
- Parallelization settings
- Git settings (branching strategy, mode)
```

Replace with:

```
Then present the configuration menu using the **settings-category-select** pattern (see `skills/shared/gate-prompts.md`):

Use AskUserQuestion:
  question: "What would you like to configure?"
  header: "Configure"
  options:
    - label: "Depth"          description: "quick/standard/comprehensive"
    - label: "Model profile"  description: "quality/balanced/budget/adaptive"
    - label: "Features"       description: "Toggle workflow features and gates"
    - label: "Git settings"   description: "branching strategy, commit mode"
  multiSelect: false

Note: The original 7 categories are condensed to 4. "Models" (per-agent) is accessible through "Model profile" with a follow-up option. "Gates" and "Parallelization" are grouped under "Features".

**Follow-up based on selection:**

If user selects "Depth":
Use AskUserQuestion:
  question: "Select workflow depth"
  header: "Depth"
  options:
    - label: "Quick"           description: "Minimal research, fast execution"
    - label: "Standard"        description: "Balanced research and execution (default)"
    - label: "Comprehensive"   description: "Full research, thorough verification"
  multiSelect: false

If user selects "Model profile":
Use the **model-profile-select** pattern:
Use AskUserQuestion:
  question: "Select model profile"
  header: "Profile"
  options:
    - label: "Quality"    description: "opus for all agents (highest cost)"
    - label: "Balanced"   description: "sonnet/inherit mix (default)"
    - label: "Budget"     description: "haiku for all agents (lowest cost)"
    - label: "Adaptive"   description: "sonnet planning, haiku execution"
  multiSelect: false

If user asks for per-agent model selection (typed "models" or "per-agent"), present individual agent selection as plain text: list the agents and ask which one to change, then ask for the model. This is a freeform flow because agent names are dynamic.

If user selects "Features":
List all features and gates with current status, then use the **toggle-confirm** pattern for each change:
Use AskUserQuestion:
  question: "Enable {feature_name}?"
  header: "Toggle"
  options:
    - label: "Enable"   description: "Turn this feature on"
    - label: "Disable"  description: "Turn this feature off"
  multiSelect: false

Repeat for each feature the user wants to change. Show updated status after each toggle.

If user selects "Git settings":
Use AskUserQuestion:
  question: "Select branching strategy"
  header: "Branching"
  options:
    - label: "None"        description: "All work on current branch"
    - label: "Phase"       description: "New branch per phase"
    - label: "Milestone"   description: "New branch per milestone"
    - label: "Disabled"    description: "No git integration"
  multiSelect: false

If user types something else (freeform): interpret as a direct setting command and handle via Step 2 argument parsing logic.
```

4. Keep Step 4 "Apply Changes" as-is -- it's the execution step, not the UI step
5. Keep all other sections (Config Schema, Version Migration, Model Profile Presets, Feature Reference, Validation) unchanged
  </action>
  <verify>
node -e "const fs = require('fs'); const c = fs.readFileSync('plugins/dev/skills/config/SKILL.md', 'utf8'); const fm = c.split('---')[1]; console.log('Has AskUserQuestion in tools:', fm.includes('AskUserQuestion')); console.log('Has settings-category-select ref:', c.includes('settings-category-select')); console.log('Has toggle-confirm ref:', c.includes('toggle-confirm')); console.log('Has model-profile-select ref:', c.includes('model-profile-select')); console.log('No old 7-option list:', !c.includes('Parallelization settings'));"
  </verify>
  <done>/dev:config category selection uses AskUserQuestion with 4 primary options; toggle and model profile changes use AskUserQuestion; old 7-option text menu is replaced</done>
</task>
