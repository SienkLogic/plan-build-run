---
phase: "16-config-routing-upgrades"
plan: "16-02"
type: "feature"
wave: 1
depends_on: []
files_modified:
  - "plugins/dev/skills/status/SKILL.md"
  - "plugins/dev/skills/resume/SKILL.md"
autonomous: true
dependency_fingerprints:
  "15-01": "len:4037-mod:2026-02-10T20:26"
  "15-02": "len:4079-mod:2026-02-10T20:26"
discovery: 0
must_haves:
  truths:
    - "/dev:status routing suggestions use AskUserQuestion with dynamically generated action options"
    - "/dev:resume pause-point selection uses AskUserQuestion when multiple pause points exist"
    - "/dev:resume next action suggestion uses AskUserQuestion for structured selection"
    - "Status and resume skills remain read-only (no Task spawning, no auto-execution)"
  artifacts:
    - "plugins/dev/skills/status/SKILL.md (converted to AskUserQuestion)"
    - "plugins/dev/skills/resume/SKILL.md (converted to AskUserQuestion)"
  key_links:
    - "status SKILL.md references action-routing pattern from gate-prompts.md"
    - "resume SKILL.md references pause-point-select pattern from gate-prompts.md"
    - "resume SKILL.md references action-routing pattern from gate-prompts.md"
---

# Plan 16-02: Convert Status and Resume Skills to AskUserQuestion

## Goal

Convert the status skill's "what to do next" routing and the resume skill's pause-point selection and next-action suggestions from freeform text to structured AskUserQuestion prompts. Both skills remain read-only -- they present structured options for the user to act on, but do not auto-execute.

## Context

The status skill currently displays "Next step: --> /dev:build 2 -- explanation" as plain text. The resume skill mentions AskUserQuestion for multiple pause points but uses text formatting, not the proper AskUserQuestion structure. Both skills' anti-patterns explicitly prohibit auto-execution, so these conversions are display-only upgrades.

## Design Decision: Keep Read-Only

Research recommended making status and resume executable by adding Task to allowed-tools. This plan deliberately keeps both skills read-only because:
1. Status SKILL.md anti-patterns say "DO NOT spawn any Task agents" (line 310)
2. Resume SKILL.md anti-patterns say "DO NOT auto-execute the suggested next action" (line 318)
3. The continue skill already provides the auto-execution behavior
4. Changing to executable would be a behavioral scope change beyond this phase's goal

The AskUserQuestion prompts will present structured options. When the user selects one, the skill displays the command to run. The user then invokes it manually or uses `/dev:continue`.

---

<task id="16-02-T1" type="auto" tdd="false">
  <name>Convert status SKILL.md routing suggestions to AskUserQuestion</name>
  <files>
    plugins/dev/skills/status/SKILL.md
  </files>
  <action>
1. Read `plugins/dev/skills/status/SKILL.md` to confirm current content
2. In the `allowed-tools` frontmatter, add `AskUserQuestion` to the list. Change from `Read, Glob, Grep` to `Read, Glob, Grep, AskUserQuestion`
3. Replace Step 5 "Smart Routing" presentation section (lines 245-257). The current text reads:

```
Present the suggestion:
```
Next step:
--> {suggested command} -- {brief explanation}
```

If multiple reasonable next actions exist, show up to 3:
```
Suggested next steps:
--> {primary suggestion} -- {explanation}
--> {alternative 1} -- {explanation}
--> {alternative 2} -- {explanation}
```
```

Replace with:

```
**If only one reasonable next action exists**, present it directly:

```
Next step:
--> {suggested command} -- {brief explanation}
```

**If multiple reasonable next actions exist** (2-3 alternatives), use the **action-routing** pattern (see `skills/shared/gate-prompts.md`):

Use AskUserQuestion:
  question: "What would you like to do next?"
  header: "Next Step"
  options:
    - label: "{primary action}"    description: "{brief explanation}"
    - label: "{alternative 1}"     description: "{brief explanation}"
    - label: "{alternative 2}"     description: "{brief explanation}"
    - label: "Something else"      description: "Enter a different command"
  multiSelect: false

Build options dynamically from the decision tree results. Always include "Something else" as the last option. Generate 1-3 real options based on the state analysis.

**After user selects an option:**
- If they selected a real action: display "Run: `/dev:{action} {args}`" so they can execute it
- If they selected "Something else": ask what they'd like to do (freeform text)
- This skill remains read-only — display the command, do not execute it
```

4. In the Anti-Patterns section (line 316-322), add a new anti-pattern after existing ones:
   `8. **DO NOT** execute the suggested action — present it for the user to run manually. Use /dev:continue for auto-execution.`
5. Keep all other sections (Steps 1-4, Edge Cases, Performance) unchanged
  </action>
  <verify>
node -e "const fs = require('fs'); const c = fs.readFileSync('plugins/dev/skills/status/SKILL.md', 'utf8'); const fm = c.split('---')[1]; console.log('Has AskUserQuestion in tools:', fm.includes('AskUserQuestion')); console.log('Has action-routing ref:', c.includes('action-routing')); console.log('Has old arrow format:', c.includes('--> {primary suggestion}')); console.log('Still read-only:', !fm.includes('Task')); console.log('Anti-pattern about no-execute:', c.includes('DO NOT') && c.includes('execute the suggested action'));"
  </verify>
  <done>/dev:status routing suggestions use AskUserQuestion with dynamically generated action options when multiple alternatives exist; skill remains read-only with no Task tool</done>
</task>

<task id="16-02-T2" type="auto" tdd="false">
  <name>Convert resume SKILL.md pause-point and next-action to AskUserQuestion</name>
  <files>
    plugins/dev/skills/resume/SKILL.md
  </files>
  <action>
1. Read `plugins/dev/skills/resume/SKILL.md` to confirm current content
2. In the `allowed-tools` frontmatter, add `AskUserQuestion` to the list. Change from `Read, Write, Glob, Grep` to `Read, Write, Glob, Grep, AskUserQuestion`

**Conversion Point 1: Multiple pause point selection (lines 96-106)**

3. Replace the current text-format AskUserQuestion (lines 96-106):

Current:
```
**If multiple found:**
- Present to user via AskUserQuestion:
  ```
  Found multiple pause points:
  1. Phase {A} -- paused {date}
  2. Phase {B} -- paused {date}

  Which would you like to resume?
  ```
- Use the selected one.
```

Replace with:
```
**If multiple found:**
Use the **pause-point-select** pattern (see `skills/shared/gate-prompts.md`):

Use AskUserQuestion:
  question: "Found multiple pause points. Which would you like to resume?"
  header: "Resume"
  options:
    - label: "Phase {A}"  description: "Paused {date}, {brief context}"
    - label: "Phase {B}"  description: "Paused {date}, {brief context}"
    - label: "Phase {C}"  description: "Paused {date}, {brief context}"
    - label: "Phase {D}"  description: "Paused {date}, {brief context}"
  multiSelect: false

Build options dynamically from discovered `.continue-here.md` files. Include phase name and pause date in each option. If more than 4 pause points exist, show the 4 most recent and replace the last option with:
  - label: "Show earlier"  description: "See older pause points"

When "Show earlier" is selected, re-prompt with the next batch of 4.

Use the selected pause point for the rest of the resume flow.
```

**Conversion Point 2: Next action suggestion (lines 154-159)**

4. Replace the plain-text next action display (lines 154-159):

Current:
```
5. Present the next action from the continue-here file:

```
Next step:
--> {suggested command} -- {explanation from continue-here}
```
```

Replace with:
```
5. Present the next action from the continue-here file.

**If only one clear next action exists**, present it directly:
```
Next step:
--> {suggested command} -- {explanation from continue-here}
```

**If multiple reasonable actions exist** (e.g., the continue-here suggests one thing but the filesystem state suggests another), use the **action-routing** pattern (see `skills/shared/gate-prompts.md`):

Use AskUserQuestion:
  question: "How would you like to proceed?"
  header: "Next Step"
  options:
    - label: "{continue-here suggestion}"   description: "Resume from pause point"
    - label: "{filesystem-inferred action}"  description: "Based on current state"
    - label: "Show status"                   description: "Run /dev:status for full overview"
    - label: "Something else"                description: "Enter a different command"
  multiSelect: false

**After user selects an option:**
- Display "Run: `/dev:{action} {args}`" so the user can execute it
- This skill does not auto-execute — it suggests and the user acts
```

5. Also update the inferred resume section (Step 3b, around line 187-191) to use action-routing pattern for its suggestion:

Replace the current:
```
5. Suggest the next action based on phase state:
   - Incomplete plans exist: `/dev:build {N}`
   - All plans complete, no verification: `/dev:review {N}`
   - Verification exists with gaps: `/dev:plan {N} --gaps`
   - Phase complete: `/dev:plan {N+1}`
```

With:
```
5. Suggest the next action based on phase state using the **action-routing** pattern:

Use AskUserQuestion:
  question: "What would you like to do next?"
  header: "Next Step"
  options: (build dynamically from phase state)
    - label: "/dev:build {N}"       description: "Continue building (plans remaining)"
    - label: "/dev:review {N}"      description: "Review completed phase"
    - label: "/dev:plan {N} --gaps" description: "Fix verification gaps"
    - label: "/dev:plan {N+1}"      description: "Plan the next phase"
  multiSelect: false

Show only the options that apply to the current state (1-3 real options + "Something else").
```

6. Keep all other sections (Auto-Reconcile, State Validation, Edge Cases, Anti-Patterns) unchanged
  </action>
  <verify>
node -e "const fs = require('fs'); const c = fs.readFileSync('plugins/dev/skills/resume/SKILL.md', 'utf8'); const fm = c.split('---')[1]; console.log('Has AskUserQuestion in tools:', fm.includes('AskUserQuestion')); console.log('Has pause-point-select ref:', c.includes('pause-point-select')); console.log('Has action-routing ref:', c.includes('action-routing')); console.log('No old numbered list format:', !c.includes('1. Phase {A} -- paused')); console.log('Still no Task tool:', !fm.includes('Task'));"
  </verify>
  <done>/dev:resume pause-point selection uses structured AskUserQuestion when multiple pause points exist; next action suggestion uses AskUserQuestion when multiple options apply; skill remains read-only</done>
</task>
