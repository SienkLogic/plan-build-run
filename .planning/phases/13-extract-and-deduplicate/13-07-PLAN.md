---
phase: "13-extract-and-deduplicate"
plan: "13-07"
type: "refactor"
wave: 1
depends_on: []
files_modified:
  - "plugins/dev/templates/VERIFICATION-DETAIL.md.tmpl"
  - "plugins/dev/agents/towline-verifier.md"
  - "plugins/dev/templates/INTEGRATION-REPORT.md.tmpl"
  - "plugins/dev/agents/towline-integration-checker.md"
autonomous: true
discovery: 0
must_haves:
  truths:
    - "towline-verifier.md contains no inline output format template (references external file)"
    - "towline-integration-checker.md contains no inline output format template (references external file)"
    - "Both agents reference their output format templates via Read instructions"
  artifacts:
    - "plugins/dev/templates/VERIFICATION-DETAIL.md.tmpl"
    - "plugins/dev/templates/INTEGRATION-REPORT.md.tmpl"
  key_links:
    - "towline-verifier.md Output Format section references VERIFICATION-DETAIL.md.tmpl"
    - "towline-integration-checker.md Output Format section references INTEGRATION-REPORT.md.tmpl"
---

# Plan 13-07: Extract verifier and integration-checker agent output format templates

This plan extracts the inline output format templates from the verifier agent (~115 lines) and integration-checker agent (~150 lines) into external template files in the shared `templates/` directory. Both agent definitions are updated to reference external files.

Note: A `templates/VERIFICATION.md.tmpl` already exists as a simpler version. The verifier agent has a more detailed version inline. The extracted template is named `VERIFICATION-DETAIL.md.tmpl` to distinguish it from the existing simpler template.

<task id="13-07-T1" type="auto" tdd="false">
  <name>Extract verifier agent output format template</name>
  <files>
    plugins/dev/templates/VERIFICATION-DETAIL.md.tmpl
    plugins/dev/agents/towline-verifier.md
  </files>
  <action>
1. Extract the output format template from `agents/towline-verifier.md` lines 333-446 (content inside the code fence under "## Output Format"). Write to `plugins/dev/templates/VERIFICATION-DETAIL.md.tmpl` with this header:
   ```
   <!-- Source: agents/towline-verifier.md | Purpose: Detailed output format for verification reports produced by the verifier agent -->
   ```
   Then the exact content starting with the YAML frontmatter `---` (containing phase, verified, status, is_re_verification, score, gaps, anti_patterns fields) through `3. ...` in the Recommendations section.
   This includes all sections: Observable Truths table, Artifact Verification table, Key Link Verification table, Gaps Found, Human Verification Items, Anti-Pattern Scan table, Regressions table, and Summary with Phase Health metrics and Recommendations.

2. Update `agents/towline-verifier.md`:
   Replace the "## Output Format" section (the heading, the brief intro text, the code fence, and all content within the code fence) with:
   ```markdown
   ## Output Format

   Write to `.planning/phases/{phase_dir}/VERIFICATION.md`.

   Read the output format template from `templates/VERIFICATION-DETAIL.md.tmpl` and use it as the format for your verification report. Fill in all placeholders with verification results:
   - YAML frontmatter: phase ID, timestamp, status, score breakdown, gaps list, anti-pattern counts
   - Observable Truths table: each truth with status and evidence
   - Artifact Verification table: each artifact with 3-level check results
   - Key Link Verification table: each link with connection status and evidence
   - Gaps Found section: one subsection per gap with must-have, level, evidence, impact, recommendation
   - Human Verification Items: items requiring manual testing
   - Anti-Pattern Scan table: counts by category with file references
   - Regressions table: only in re-verification mode
   - Summary: phase health metrics and prioritized recommendations
   ```

3. Preserve ALL other content in the agent definition (Core Principle, Critical Constraints, the 10-Step Verification Process, and everything after the Output Format section).
  </action>
  <verify>
ls -la plugins/dev/templates/VERIFICATION-DETAIL.md.tmpl
wc -l plugins/dev/agents/towline-verifier.md
grep -c "Read the output format template from" plugins/dev/agents/towline-verifier.md
  </verify>
  <done>
    VERIFICATION-DETAIL.md.tmpl exists in templates/. towline-verifier.md references it via Read instruction and is shorter than the original 674 lines (expected ~560-580 lines).
  </done>
</task>

<task id="13-07-T2" type="auto" tdd="false">
  <name>Extract integration-checker agent output format template</name>
  <files>
    plugins/dev/templates/INTEGRATION-REPORT.md.tmpl
    plugins/dev/agents/towline-integration-checker.md
  </files>
  <action>
1. Extract the output format template from `agents/towline-integration-checker.md` lines 392-540 (content inside the code fence under "## Output Format"). Write to `plugins/dev/templates/INTEGRATION-REPORT.md.tmpl` with this header:
   ```
   <!-- Source: agents/towline-integration-checker.md | Purpose: Output format for cross-phase integration verification reports -->
   ```
   Then the exact content starting with `# Integration Verification Report` through `4. ...` in the Recommendations section.
   This includes all sections: Phase Dependency Graph, Export/Import Wiring (with Export Status Summary, Detailed Export Map, Orphaned Exports, Unused Imports tables), API Coverage (Route Coverage Matrix, Uncovered Routes, Missing Handlers), Auth Protection (Route Protection Summary, Unprotected Routes, Auth Flow Completeness), End-to-End Flows (flow status tables), Integration Issues Summary (Critical/Warnings/Info), Integration Score table, and Recommendations.

2. Update `agents/towline-integration-checker.md`:
   Replace the "## Output Format" section (the heading, the code fence, and all content within the code fence at lines 390-540) with:
   ```markdown
   ## Output Format

   Read the output format template from `templates/INTEGRATION-REPORT.md.tmpl` and use it as the format for your integration report. Fill in all placeholders with verification results:
   - Phase Dependency Graph: ASCII graph of phase relationships
   - Export/Import Wiring: tables for export status, detailed map, orphaned exports, unused imports
   - API Coverage: route coverage matrix, uncovered routes, missing handlers
   - Auth Protection: protection summary, unprotected routes, auth flow completeness
   - End-to-End Flows: flow verification tables with step-by-step status
   - Integration Issues: categorized as Critical, Warnings, Info with evidence and fix suggestions
   - Integration Score: category-level and overall pass/fail percentages
   - Recommendations: prioritized action list
   ```

3. Preserve ALL other content in the agent definition (Core Principle, Critical Constraints, 6-Step Verification Process, flow definitions in Step 5, When This Agent Is Spawned, Technology-Specific Patterns, Anti-Patterns, Interaction with Other Agents).
  </action>
  <verify>
ls -la plugins/dev/templates/INTEGRATION-REPORT.md.tmpl
wc -l plugins/dev/agents/towline-integration-checker.md
grep -c "Read the output format template from" plugins/dev/agents/towline-integration-checker.md
  </verify>
  <done>
    INTEGRATION-REPORT.md.tmpl exists in templates/. towline-integration-checker.md references it via Read instruction and is shorter than the original 650 lines (expected ~510-530 lines).
  </done>
</task>
