---
phase: "13-extract-and-deduplicate"
plan: "13-04"
type: "refactor"
wave: 1
depends_on: []
files_modified:
  - "plugins/dev/skills/begin/templates/researcher-prompt.md.tmpl"
  - "plugins/dev/skills/begin/templates/synthesis-prompt.md.tmpl"
  - "plugins/dev/skills/begin/templates/roadmap-prompt.md.tmpl"
  - "plugins/dev/skills/begin/SKILL.md"
  - "plugins/dev/skills/discuss/templates/CONTEXT.md.tmpl"
  - "plugins/dev/skills/discuss/templates/decision-categories.md"
  - "plugins/dev/skills/discuss/SKILL.md"
autonomous: true
discovery: 0
must_haves:
  truths:
    - "begin/SKILL.md references 3 external templates via Read instructions instead of inline code fences"
    - "discuss/SKILL.md references 2 external templates via Read instructions instead of inline code fences"
  artifacts:
    - "plugins/dev/skills/begin/templates/researcher-prompt.md.tmpl"
    - "plugins/dev/skills/begin/templates/synthesis-prompt.md.tmpl"
    - "plugins/dev/skills/begin/templates/roadmap-prompt.md.tmpl"
    - "plugins/dev/skills/discuss/templates/CONTEXT.md.tmpl"
    - "plugins/dev/skills/discuss/templates/decision-categories.md"
  key_links:
    - "begin/SKILL.md Step 5 references researcher-prompt.md.tmpl"
    - "begin/SKILL.md Step 6 references synthesis-prompt.md.tmpl"
    - "begin/SKILL.md Step 8 references roadmap-prompt.md.tmpl"
    - "discuss/SKILL.md Step 7 references discuss/templates/CONTEXT.md.tmpl"
    - "discuss/SKILL.md Step 3 references discuss/templates/decision-categories.md"
---

# Plan 13-04: Extract begin/SKILL.md and discuss/SKILL.md templates

This plan extracts 3 inline prompt templates from `skills/begin/SKILL.md` (~175 lines) and 2 inline templates from `skills/discuss/SKILL.md` (~115 lines) into external files. Both SKILLs are updated with Read references.

<task id="13-04-T1" type="auto" tdd="false">
  <name>Extract begin/SKILL.md prompt templates</name>
  <files>
    plugins/dev/skills/begin/templates/researcher-prompt.md.tmpl
    plugins/dev/skills/begin/templates/synthesis-prompt.md.tmpl
    plugins/dev/skills/begin/templates/roadmap-prompt.md.tmpl
    plugins/dev/skills/begin/SKILL.md
  </files>
  <action>
NOTE: The `skills/begin/templates/` directory already exists with 5 files (config.json.tmpl, PROJECT.md.tmpl, REQUIREMENTS.md.tmpl, ROADMAP.md.tmpl, STATE.md.tmpl). Add new files to this existing directory.

1. Extract the Researcher Prompt Template from `skills/begin/SKILL.md` lines 181-199 (content inside the code fence under "#### Researcher Prompt Template"). Write to `skills/begin/templates/researcher-prompt.md.tmpl` with this header:
   ```
   <!-- Source: begin/SKILL.md | Purpose: Prompt template for spawning researcher agents during project initialization -->
   ```
   Then the exact content starting with `<project_context>` through `Write your findings to the output file using the Project Research output format from your agent definition. Use the Write tool to create the file.`

2. Extract the Synthesis Prompt Template from `skills/begin/SKILL.md` lines 255-270 (content inside the code fence under "#### Synthesis Prompt Template"). Write to `skills/begin/templates/synthesis-prompt.md.tmpl` with this header:
   ```
   <!-- Source: begin/SKILL.md | Purpose: Prompt template for spawning synthesis agent to combine research documents -->
   ```
   Then the exact content starting with `<research_documents>` through `Write the synthesis to .planning/research/SUMMARY.md using the Write tool.`

3. Extract the Roadmap Prompt Template from `skills/begin/SKILL.md` lines 331-360 (content inside the code fence under "#### Roadmap Prompt Template"). Write to `skills/begin/templates/roadmap-prompt.md.tmpl` with this header:
   ```
   <!-- Source: begin/SKILL.md | Purpose: Prompt template for spawning planner agent in roadmap mode -->
   ```
   Then the exact content starting with `<project_context>` through `Write the roadmap to .planning/ROADMAP.md using the Write tool.`

4. Update `skills/begin/SKILL.md`:

   a. **Step 5 -- Researcher Prompt Template** (lines 177-199):
      Replace the "#### Researcher Prompt Template" heading and its code fence content with:
      ```markdown
      #### Researcher Prompt Template

      Read `skills/begin/templates/researcher-prompt.md.tmpl` and use it as the prompt template for each researcher agent. Fill in the placeholders for each research topic:
      - `{project name from questioning}` - project name
      - `{2-3 sentence description from questioning}` - project description
      - `{any locked technology choices}` - technology constraints
      - `{budget, timeline, skill level, etc.}` - user constraints
      - `{topic}` - research topic name (e.g., "Technology Stack Analysis")
      - `{TOPIC}` - output filename (e.g., STACK.md)
      - `{topic-specific questions}` - questions from the topic list below
      ```

   b. **Step 6 -- Synthesis Prompt Template** (lines 253-270):
      Replace the "#### Synthesis Prompt Template" heading and its code fence content with:
      ```markdown
      #### Synthesis Prompt Template

      Read `skills/begin/templates/synthesis-prompt.md.tmpl` and use it as the prompt template for the synthesis agent. Fill in the placeholders:
      - `{List all .planning/research/*.md files that were created}` - file paths of research documents
      ```

   c. **Step 8 -- Roadmap Prompt Template** (lines 329-360):
      Replace the "#### Roadmap Prompt Template" heading and its code fence content with:
      ```markdown
      #### Roadmap Prompt Template

      Read `skills/begin/templates/roadmap-prompt.md.tmpl` and use it as the prompt template for the roadmap planner. Fill in the placeholders:
      - `{project name}` - project name from questioning
      - `{description}` - project description
      - `{quick|standard|comprehensive}` - depth setting from config
      ```

5. Preserve ALL other content in begin/SKILL.md. Only the 3 inline prompt code fences are being replaced.
  </action>
  <verify>
ls -la plugins/dev/skills/begin/templates/
wc -l plugins/dev/skills/begin/SKILL.md
grep -c "Read \`skills/begin/templates/" plugins/dev/skills/begin/SKILL.md
awk "/^```/{start=NR; count=0; next} /^```/{if(NR-start>20) print FILENAME\": block at line \"start\" is \"(NR-start)\" lines\"; next}" plugins/dev/skills/begin/SKILL.md
  </verify>
  <done>
    begin/templates/ contains 8 files (5 existing + 3 new prompt templates). begin/SKILL.md references all 3 new templates via Read instructions, is under 440 lines (down from 516), and no code-fence blocks exceed 20 lines.
  </done>
</task>

<task id="13-04-T2" type="auto" tdd="false">
  <name>Extract discuss/SKILL.md templates</name>
  <files>
    plugins/dev/skills/discuss/templates/CONTEXT.md.tmpl
    plugins/dev/skills/discuss/templates/decision-categories.md
    plugins/dev/skills/discuss/SKILL.md
  </files>
  <action>
1. Create directory `plugins/dev/skills/discuss/templates/`

2. Extract the CONTEXT.md template from `skills/discuss/SKILL.md` lines 170-217 (the markdown content under Step 7: Write CONTEXT.md, inside the code fence showing the template format). Write to `skills/discuss/templates/CONTEXT.md.tmpl` with this header:
   ```
   <!-- Source: discuss/SKILL.md | Purpose: Template for phase-level CONTEXT.md generated by /dev:discuss -->
   ```
   Then the exact content starting with `# Phase {N} Context` through `- **{Concern}** -- {Context from the conversation}`. This is the full CONTEXT.md template with all sections: Decisions (LOCKED), Deferred Ideas (EXCLUDED), Claude's Discretion (OPEN), User's Vision Summary, User's Concerns.

3. Extract the Decision Categories table from `skills/discuss/SKILL.md` lines 95-103 (the table in Step 3 showing gray area categories). Write to `skills/discuss/templates/decision-categories.md` with this header:
   ```
   <!-- Source: discuss/SKILL.md | Purpose: Reference table of gray area categories for identifying discussion topics -->
   ```
   Then the exact table content:
   ```
   | Category | Example Gray Areas |
   |----------|-------------------|
   | **UI/UX choices** | Layout approach, component library, responsive strategy, accessibility level |
   | **Architecture decisions** | State management approach, API design style, database schema trade-offs |
   | **Edge case behavior** | What happens on failure, empty states, concurrent access, rate limiting |
   | **Technology selections** | Which library for X, build tool choice, testing framework preference |
   | **Feature scope boundaries** | MVP vs full feature, what to include vs defer, depth of implementation |
   ```

4. Update `skills/discuss/SKILL.md`:

   a. **Step 3 -- Decision Categories table** (lines 95-103):
      Replace the inline table with:
      ```markdown
      Read `skills/discuss/templates/decision-categories.md` for the gray area categories to use when identifying discussion topics.
      ```

   b. **Step 7 -- CONTEXT.md template** (lines 167-217):
      Replace the inline code fence showing the CONTEXT.md format with:
      ```markdown
      Read `skills/discuss/templates/CONTEXT.md.tmpl` and use it as the template for the phase CONTEXT.md file. Fill in all placeholders:
      - `{N}` - phase number
      - `{ISO date}` - current date
      - Decision entries from the conversation (title, choice, scope, quality, integration, notes)
      - Deferred ideas from Step 6
      - Claude's Discretion items
      - User's Vision Summary (2-3 sentences in the user's voice)
      - User's Concerns from the conversation
      ```
      Keep the existing "**Path:** `.planning/phases/{NN}-{phase-name}/CONTEXT.md`" line and the "**Content:**" label, but replace only the code fence block.

5. Preserve ALL other content in discuss/SKILL.md (flow steps, edge cases, anti-patterns, etc.).
  </action>
  <verify>
ls -la plugins/dev/skills/discuss/templates/
wc -l plugins/dev/skills/discuss/SKILL.md
grep -c "Read \`skills/discuss/templates/" plugins/dev/skills/discuss/SKILL.md
awk "/^```/{start=NR; count=0; next} /^```/{if(NR-start>20) print FILENAME\": block at line \"start\" is \"(NR-start)\" lines\"; next}" plugins/dev/skills/discuss/SKILL.md
  </verify>
  <done>
    discuss/templates/ contains 2 files (CONTEXT.md.tmpl, decision-categories.md). discuss/SKILL.md references both via Read instructions, is under 280 lines (down from 332), and no code-fence blocks exceed 20 lines.
  </done>
</task>
