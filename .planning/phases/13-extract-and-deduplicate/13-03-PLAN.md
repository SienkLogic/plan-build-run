---
phase: "13-extract-and-deduplicate"
plan: "13-03"
type: "refactor"
wave: 1
depends_on: []
files_modified:
  - "plugins/dev/skills/review/templates/verifier-prompt.md.tmpl"
  - "plugins/dev/skills/review/templates/debugger-prompt.md.tmpl"
  - "plugins/dev/skills/review/templates/gap-planner-prompt.md.tmpl"
  - "plugins/dev/skills/review/SKILL.md"
autonomous: true
discovery: 0
must_haves:
  truths:
    - "review/SKILL.md contains no inline prompt templates longer than 20 lines"
    - "All 3 prompt templates exist as external files in review/templates/"
    - "review/SKILL.md references each template via Read instruction with placeholder documentation"
  artifacts:
    - "plugins/dev/skills/review/templates/verifier-prompt.md.tmpl"
    - "plugins/dev/skills/review/templates/debugger-prompt.md.tmpl"
    - "plugins/dev/skills/review/templates/gap-planner-prompt.md.tmpl"
  key_links:
    - "review/SKILL.md Step 3 references verifier-prompt.md.tmpl"
    - "review/SKILL.md Step 6a references debugger-prompt.md.tmpl"
    - "review/SKILL.md Step 6b references gap-planner-prompt.md.tmpl"
---

# Plan 13-03: Extract review/SKILL.md prompt templates

This plan extracts 3 inline prompt templates from `skills/review/SKILL.md` (~210 lines total) into external template files in `skills/review/templates/`. The SKILL.md is updated with Read references.

<task id="13-03-T1" type="auto" tdd="false">
  <name>Create review/templates/ directory and extract 3 prompt templates</name>
  <files>
    plugins/dev/skills/review/templates/verifier-prompt.md.tmpl
    plugins/dev/skills/review/templates/debugger-prompt.md.tmpl
    plugins/dev/skills/review/templates/gap-planner-prompt.md.tmpl
  </files>
  <action>
1. Create directory `plugins/dev/skills/review/templates/`

2. Extract the Verifier Prompt Template from `skills/review/SKILL.md` lines 88-197 (content inside the code fence under "#### Verifier Prompt Template"). Write to `skills/review/templates/verifier-prompt.md.tmpl` with this header:
   ```
   <!-- Source: review/SKILL.md | Purpose: Prompt template for spawning verifier agent during phase review -->
   ```
   Then the exact content starting with `You are a verification agent. Your job is to verify that a phase build matches its plans.` through `Use the Write tool to create the verification report. Use Bash, Grep, and Glob for checks.`
   This includes the `<verification_methodology>`, `<phase_plans>`, `<build_results>`, and `<instructions>` blocks with the full report format specification.

3. Extract the Debugger Prompt Template from `skills/review/SKILL.md` lines 330-372 (content inside the code fence under "##### Debugger Prompt Template"). Write to `skills/review/templates/debugger-prompt.md.tmpl` with this header:
   ```
   <!-- Source: review/SKILL.md | Purpose: Prompt template for spawning debugger agent during auto-fix -->
   ```
   Then the exact content starting with `You are a debugging agent. Analyze these verification failures and determine root causes.` through `Use Read, Grep, Glob, and Bash tools to investigate. Return your analysis as text.`

4. Extract the Gap Planner Prompt Template from `skills/review/SKILL.md` lines 388-419 (content inside the code fence under "##### Gap Planner Prompt Template"). Write to `skills/review/templates/gap-planner-prompt.md.tmpl` with this header:
   ```
   <!-- Source: review/SKILL.md | Purpose: Prompt template for spawning planner in gap closure mode during auto-fix -->
   ```
   Then the exact content starting with `You are the towline-planner agent operating in Gap Closure mode.` through `Use the Write tool.`

IMPORTANT: Preserve exact formatting, XML tags, placeholder syntax, pipe-delimited tables, and indentation from the originals.
  </action>
  <verify>
ls -la plugins/dev/skills/review/templates/
wc -l plugins/dev/skills/review/templates/*.md.tmpl
  </verify>
  <done>
    3 template files exist in review/templates/ with content matching the originals from review/SKILL.md.
  </done>
</task>

<task id="13-03-T2" type="auto" tdd="false">
  <name>Update review/SKILL.md to reference external templates</name>
  <files>
    plugins/dev/skills/review/SKILL.md
  </files>
  <action>
1. Open `skills/review/SKILL.md` and make these replacements:

2. **Step 3 -- Verifier Prompt Template** (lines 86-197):
   Replace the "#### Verifier Prompt Template" section (the heading, the code fence, and all content within) with:
   ```markdown
   #### Verifier Prompt Template

   Read `skills/review/templates/verifier-prompt.md.tmpl` and use it as the prompt template for spawning the verifier agent. Fill in the placeholders:
   - `<verification_methodology>` - already filled in the template (three-layer check process)
   - `<phase_plans>` - for each PLAN.md file, inline the YAML frontmatter (specifically the must_haves block)
   - `<build_results>` - for each SUMMARY.md file, inline the full content
   - `<instructions>` - already filled in the template (extraction, checking, and report format)
   - `{NN}-{slug}` - the phase directory name
   ```

3. **Step 6a -- Debugger Prompt Template** (lines 327-372):
   Replace the "##### Debugger Prompt Template" section (the heading, the code fence, and all content within) with:
   ```markdown
   ##### Debugger Prompt Template

   Read `skills/review/templates/debugger-prompt.md.tmpl` and use it as the prompt template for spawning the debugger agent. Fill in the placeholders:
   - `<verification_report>` - inline the VERIFICATION.md content (specifically the Gaps Found section)
   - `<build_summaries>` - inline all SUMMARY.md files for the phase (check deviations, known issues)
   - `<plans>` - inline all PLAN.md files for the phase (what was supposed to be built)
   - `<instructions>` - already filled in the template (investigation process and output format)
   ```

4. **Step 6b -- Gap Planner Prompt Template** (lines 385-420):
   Replace the "##### Gap Planner Prompt Template" section (the heading, the code fence, and all content within) with:
   ```markdown
   ##### Gap Planner Prompt Template

   Read `skills/review/templates/gap-planner-prompt.md.tmpl` and use it as the prompt template for spawning the planner in gap closure mode. Fill in the placeholders:
   - `<verification_report>` - inline VERIFICATION.md
   - `<root_cause_analysis>` - inline the debugger's root cause analysis output
   - `<existing_plans>` - inline all existing PLAN.md files for the phase
   - `<project_context>` - inline CONTEXT.md if it exists
   - `<gap_closure_instructions>` - specify output path and rules (already in template)
   - `{NN}-{slug}` - the phase directory name
   ```

5. Preserve ALL other content in the SKILL.md (argument parsing, orchestration flow, UAT section, error handling, completion section, etc.). Only the inline template code fences are being replaced.
  </action>
  <verify>
wc -l plugins/dev/skills/review/SKILL.md
grep -c "Read \`skills/review/templates/" plugins/dev/skills/review/SKILL.md
awk "/^```/{start=NR; count=0; next} /^```/{if(NR-start>20) print FILENAME\": block at line \"start\" is \"(NR-start)\" lines\"; next}" plugins/dev/skills/review/SKILL.md
  </verify>
  <done>
    review/SKILL.md references all 3 external templates via Read instructions. The file is under 440 lines (down from 591) and all template references use Read instructions. No code-fence blocks exceed 20 lines.
  </done>
</task>
