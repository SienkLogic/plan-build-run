---
phase: "13-extract-and-deduplicate"
plan: "13-08"
type: "refactor"
wave: 2
depends_on: ["13-01", "13-02", "13-03", "13-04", "13-05", "13-06", "13-07"]
files_modified: []
autonomous: true
discovery: 0
must_haves:
  truths:
    - "All existing tests pass after template extraction"
    - "No SKILL.md file contains inline templates longer than 20 lines"
    - "No agent definition contains inline document format templates"
    - "Net line reduction is approximately 1,500-1,900 lines across all modified files"
    - "Shared templates/ directory contains verification, integration, and codebase output templates"
    - "Skill-local templates/ directories exist for: plan, review, begin, discuss, debug, milestone, pause, quick"
    - "Remaining SKILL.md files (build, health, import, config, help, continue, resume, status, note, explore, todo) contain no inline templates >20 lines"
  artifacts: []
  key_links:
    - "Test suite validates that extraction did not break any functionality"
---

# Plan 13-08: Verification -- test suite and line count audit

This is a verification-only plan. No files are modified. It runs the full test suite and audits the extraction results to confirm all success criteria are met, including verification that SKILL.md files not addressed by other plans have no extractable inline templates.

<task id="13-08-T1" type="auto" tdd="false">
  <name>Run full test suite and verify no regressions</name>
  <files>
  </files>
  <action>
1. Run the full test suite:
   ```bash
   cd D:/Repos/towline && npm test
   ```

2. If any tests fail:
   - Read the failure output
   - Determine if the failure is related to the template extraction (unlikely -- tests don't validate inline template content)
   - If related: note the issue for gap closure
   - If unrelated (pre-existing failure): note as pre-existing

3. Record the test results (pass/fail count, any failures).
  </action>
  <verify>
cd D:/Repos/towline && npm test
  </verify>
  <done>
    All existing tests pass. The template extraction introduced no regressions.
  </done>
</task>

<task id="13-08-T2" type="auto" tdd="false">
  <name>Audit line counts, code-fence sizes, and verify extraction success criteria</name>
  <files>
  </files>
  <action>
1. Count lines in all modified SKILL.md and agent definition files and compare to originals:
   ```bash
   wc -l plugins/dev/skills/plan/SKILL.md plugins/dev/skills/scan/SKILL.md plugins/dev/skills/review/SKILL.md plugins/dev/skills/begin/SKILL.md plugins/dev/skills/discuss/SKILL.md plugins/dev/skills/debug/SKILL.md plugins/dev/skills/pause/SKILL.md plugins/dev/skills/milestone/SKILL.md plugins/dev/skills/quick/SKILL.md plugins/dev/agents/towline-codebase-mapper.md plugins/dev/agents/towline-verifier.md plugins/dev/agents/towline-integration-checker.md
   ```

   Original line counts for comparison:
   - plan/SKILL.md: 617
   - scan/SKILL.md: 609
   - review/SKILL.md: 591
   - begin/SKILL.md: 516
   - discuss/SKILL.md: 332
   - debug/SKILL.md: 429
   - pause/SKILL.md: 280
   - milestone/SKILL.md: 573
   - quick/SKILL.md: 289
   - agents/towline-codebase-mapper.md: 894
   - agents/towline-verifier.md: 674
   - agents/towline-integration-checker.md: 650
   - TOTAL ORIGINAL: 6,454

   Calculate net reduction: ORIGINAL_TOTAL - NEW_TOTAL = lines saved from inline content.
   Template files add lines back, but these are loaded on-demand (lazy-loaded), so they don't count against context budget.

2. Verify shared templates/ directory contains all expected template files:
   ```bash
   ls -la plugins/dev/templates/codebase/
   ls -la plugins/dev/templates/VERIFICATION-DETAIL.md.tmpl plugins/dev/templates/INTEGRATION-REPORT.md.tmpl
   ```

3. Verify skill-local templates/ directories exist for all 8 skills:
   ```bash
   for skill in plan review begin discuss debug milestone pause quick; do
     echo "=== $skill ===" && ls plugins/dev/skills/$skill/templates/ 2>/dev/null || echo "  MISSING templates dir"
   done
   ```

4. Verify all agent definitions reference external templates via Read:
   ```bash
   grep -c "Read.*template" plugins/dev/agents/towline-codebase-mapper.md plugins/dev/agents/towline-verifier.md plugins/dev/agents/towline-integration-checker.md
   ```

5. Compile a summary report with:
   - Total lines saved from SKILL.md + agent files
   - Number of template files created (expected: 7 codebase + 5 plan + 3 review + 3 begin + 2 discuss + 2 debug + 2 milestone + 1 pause + 1 quick + 2 agent output = ~28 template files)
   - Number of skill templates/ directories created (8)
   - Pass/fail for each success criterion from the phase goal
  </action>
  <verify>
# Verify: no modified SKILL.md has code-fence blocks >20 lines
for f in plugins/dev/skills/plan/SKILL.md plugins/dev/skills/scan/SKILL.md plugins/dev/skills/review/SKILL.md plugins/dev/skills/begin/SKILL.md plugins/dev/skills/discuss/SKILL.md plugins/dev/skills/debug/SKILL.md plugins/dev/skills/pause/SKILL.md plugins/dev/skills/milestone/SKILL.md plugins/dev/skills/quick/SKILL.md; do echo "=== $f ==="; awk "/^```/{if(inblock){if(count>20) print NR\": WARNING block ended, lines=\"count; inblock=0} else {start=NR; inblock=1}; count=0; next} inblock{count++}" "$f"; done

# Verify: no modified agent definition has code-fence blocks >20 lines
for f in plugins/dev/agents/towline-codebase-mapper.md plugins/dev/agents/towline-verifier.md plugins/dev/agents/towline-integration-checker.md; do echo "=== $f ==="; awk "/^```/{if(inblock){if(count>20) print NR\": WARNING block ended, lines=\"count; inblock=0} else {start=NR; inblock=1}; count=0; next} inblock{count++}" "$f"; done

# Verify: remaining SKILL.md files (not addressed by plans 13-02 through 13-06) have no code-fence blocks >20 lines
for f in plugins/dev/skills/build/SKILL.md plugins/dev/skills/health/SKILL.md plugins/dev/skills/import/SKILL.md plugins/dev/skills/config/SKILL.md plugins/dev/skills/help/SKILL.md plugins/dev/skills/continue/SKILL.md plugins/dev/skills/resume/SKILL.md plugins/dev/skills/status/SKILL.md plugins/dev/skills/note/SKILL.md plugins/dev/skills/explore/SKILL.md plugins/dev/skills/todo/SKILL.md; do if [ -f "$f" ]; then echo "=== $f ==="; awk "/^```/{if(inblock){if(count>20) print NR\": WARNING block ended, lines=\"count; inblock=0} else {start=NR; inblock=1}; count=0; next} inblock{count++}" "$f"; else echo "=== $f === NOT FOUND (skip)"; fi; done

# Verify: template file counts
ls plugins/dev/templates/codebase/*.tmpl | wc -l
ls plugins/dev/templates/*.tmpl | wc -l
for skill in plan review begin discuss debug milestone pause quick; do ls plugins/dev/skills/$skill/templates/ > /dev/null 2>&1 && echo "$skill: OK" || echo "$skill: MISSING"; done
  </verify>
  <done>
    All success criteria from the phase goal are met: (1) no SKILL.md has >20-line code-fence blocks (both modified and unmodified files verified), (2) no agent definition contains inline document format templates >20 lines, (3) 8 skill-local templates/ directories exist, (4) shared templates/ has codebase templates + agent output templates, (5) all modified files use Read calls, (6) all tests pass, (7) net reduction achieved across all modified files. Remaining SKILL.md files (build, health, import, config, help, continue, resume, status, note, explore, todo) confirmed to have no extractable inline templates.
  </done>
</task>
