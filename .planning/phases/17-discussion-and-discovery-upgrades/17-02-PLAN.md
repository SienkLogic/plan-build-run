---
phase: "17-discussion-and-discovery-upgrades"
plan: "17-02"
type: "feature"
wave: 2
depends_on: ["17-01"]
files_modified:
  - "plugins/dev/skills/discuss/SKILL.md"
  - "plugins/dev/skills/explore/SKILL.md"
autonomous: true
dependency_fingerprints:
  "16-01": "len:2747-mod:2026-02-10T23:49"
  "16-02": "len:3535-mod:2026-02-10T23:50"
  "16-03": "len:3080-mod:2026-02-10T23:50"
discovery: 0
must_haves:
  truths:
    - "discuss SKILL.md uses AskUserQuestion for CONTEXT.md handling with context-handling pattern"
    - "discuss SKILL.md uses AskUserQuestion for gray area presentations with gray-area-option pattern"
    - "discuss SKILL.md uses AskUserQuestion for follow-up questions where they are yes/no or multi-option"
    - "discuss SKILL.md has AskUserQuestion in allowed-tools"
    - "explore SKILL.md uses AskUserQuestion for output routing confirmation with output-routing pattern"
    - "explore SKILL.md existing mid-conversation research AskUserQuestion is consistent with pattern conventions"
    - "Freeform conversation elements in both skills remain as plain text"
  artifacts:
    - "plugins/dev/skills/discuss/SKILL.md (3 conversion points updated)"
    - "plugins/dev/skills/explore/SKILL.md (1 conversion point updated)"
  key_links:
    - "discuss SKILL.md references context-handling pattern by name"
    - "discuss SKILL.md references gray-area-option pattern by name"
    - "discuss SKILL.md references yes-no pattern for follow-up questions"
    - "explore SKILL.md references output-routing pattern by name"
---

# Plan 17-02: Discuss and Explore Skill Conversions

Convert the discuss and explore skills to use AskUserQuestion with pattern references from gate-prompts.md. The discuss skill has 3 conversion points (CONTEXT.md handling, gray areas, follow-ups). The explore skill has 1 conversion point (output routing) plus consistency verification of its existing AskUserQuestion usage.

## Important: Freeform Preservation

The discuss skill's open exploration (Step 2.5), domain-aware probing (Step 3), and conversational questioning are deliberately freeform. Do NOT convert these to AskUserQuestion. Only convert the structured decision points identified below.

The explore skill's Socratic conversation is deliberately open-ended. Do NOT over-structure it. Only the output routing confirmation (Step 3) gets converted.

---

<task id="17-02-T1" type="auto" tdd="false">
  <name>Convert discuss SKILL.md to use AskUserQuestion for structured decisions</name>
  <files>
    plugins/dev/skills/discuss/SKILL.md
  </files>
  <action>
1. Read `plugins/dev/skills/discuss/SKILL.md`
2. Add `AskUserQuestion` to the `allowed-tools` frontmatter (line 4). Result: `allowed-tools: Read, Write, Glob, Grep, AskUserQuestion`

3. **Step 2 CONTEXT.md handling** (lines 70-71):
The current text says "Use AskUserQuestion to let the user choose" but AskUserQuestion is not available. Now that it will be, replace the vague reference with an explicit pattern reference:
```
If CONTEXT.md exists, inform the user and use the **context-handling** pattern from `skills/shared/gate-prompts.md`:
  question: "Phase {N} already has a CONTEXT.md from a prior discussion. How should we handle it?"

Handle responses:
- "Overwrite": Replace CONTEXT.md entirely with new decisions
- "Append": Add new decisions below existing ones, marked as "Amendment ({date})"
- "Cancel": Stop the discussion, keep existing CONTEXT.md
```

4. **Step 4 gray area presentation** (lines 108-129):
The current text says "Use AskUserQuestion for each" and shows a numbered list format. Replace with an explicit pattern reference. Update lines 108-129:
```
Present each gray area to the user using the **gray-area-option** pattern from `skills/shared/gate-prompts.md`. For each gray area:

Use AskUserQuestion:
  question: "Gray Area {N}: {Title} — {Why this matters}"
  header: "Decision"
  options: (generate 2-4 concrete options from analysis, each with pros/cons in the description)
    - label: "{Option A}"       description: "{Pros: ..., Cons: ...}"
    - label: "{Option B}"       description: "{Pros: ..., Cons: ...}"
    - ...up to 4 options total, with "Let Claude decide" always as the last option
    - label: "Let Claude decide" description: "Mark as Claude's Discretion"
  multiSelect: false

If more than 3 concrete options exist for a gray area, present only the top 3 plus "Let Claude decide" (max 4 total). Mention the omitted option(s) in the question text.
```

Preserve the rules below ("Each option must be concrete and implementable", etc.) but remove the explicit numbered list format example since it's now replaced by the AskUserQuestion structure.

5. **Step 5 follow-up questions** (lines 136-147):
The current text says "Use AskUserQuestion for each." Now that AskUserQuestion is available, add guidance on WHICH follow-ups use AskUserQuestion vs freeform:

Replace lines 136-147 with:
```
For each gray area where the user made a decision (not "Let Claude decide"), ask **4 follow-up questions** to fully capture their intent.

**Follow-up question types:**

1. **Scope boundary**: "Should {feature} also handle {edge case}?"
   Use the **yes-no** pattern — this is a binary decision.

2. **Quality level**: "How polished should this be?"
   Do NOT use AskUserQuestion — this is freeform. Let the user describe their quality expectations in their own words.

3. **Integration**: "How should this interact with {existing component}?"
   Do NOT use AskUserQuestion — this is freeform. The answer depends on the specific component and context.

4. **Future-proofing**: "Should we design this to support {potential future need}, or keep it simple?"
   Use the **yes-no** pattern:
     question: "Design {feature} to support {future need}, or keep it simple for now?"
     options:
       - label: "Future-proof"  description: "Add extensibility for {future need}"
       - label: "Keep simple"   description: "Build only what's needed now"

**Rules for follow-ups:**
- Ask all 4 questions for each area
- Record exact answers (don't paraphrase)
- If the user gives a short answer, capture it as-is
- If the user says "you decide" on a follow-up, move that specific sub-decision to Claude's Discretion
```

6. **Edge case "User disagrees with all options"** (line 255):
Update from "Ask: 'What would you prefer instead?' via AskUserQuestion" to:
```
- Ask: "What would you prefer instead?" — this is freeform text, do NOT use AskUserQuestion.
- Accept any answer and lock it as a decision.
```

7. Verify no remaining references to AskUserQuestion that lack proper pattern structure.
  </action>
  <verify>
grep "AskUserQuestion" plugins/dev/skills/discuss/SKILL.md
grep "allowed-tools.*AskUserQuestion" plugins/dev/skills/discuss/SKILL.md
grep "context-handling\|gray-area-option\|yes-no" plugins/dev/skills/discuss/SKILL.md
  </verify>
  <done>discuss SKILL.md has AskUserQuestion in allowed-tools, uses context-handling pattern for CONTEXT.md handling, gray-area-option pattern for gray area presentations, and yes-no pattern for applicable follow-up questions, while preserving freeform elements</done>
</task>

<task id="17-02-T2" type="auto" tdd="false">
  <name>Convert explore SKILL.md output routing to AskUserQuestion</name>
  <files>
    plugins/dev/skills/explore/SKILL.md
  </files>
  <action>
1. Read `plugins/dev/skills/explore/SKILL.md`
2. Confirm `AskUserQuestion` is already in `allowed-tools` (line 4) — no change needed.

3. **Step 2 output routing** (lines 161-185):
The current text at line 184 says "Want to adjust, add, or remove any of these?" as plain text. Replace the Step 3 confirmation (lines 187-189) to use the output-routing pattern:

After the "Format for proposals" code block (around line 185), update Step 3:
```
### Step 3: Confirm

Use the **output-routing** pattern from `skills/shared/gate-prompts.md`:
  question: "How do you want to handle these proposed outputs?"

Handle responses:
- "Approve all": Create all suggested artifacts (proceed to Step 4)
- "Adjust": The user wants to modify proposals. Have a freeform conversation to adjust, then re-present with another AskUserQuestion.
- "Add more": The user has additional outputs. Gather them conversationally, add to the list, then re-present.
- "Skip": End the session without creating artifacts. This is fine — sometimes exploring is enough.

Do NOT create any artifacts until the user selects "Approve all" on the final set.
```

4. **Mid-conversation research** (line 110):
The existing AskUserQuestion usage is: "Ask the user via AskUserQuestion: 'I'm not sure about the best approach for {topic}. Want me to research it now, or save it as a research question for later?'"

This is already correct — it's a 2-option question that maps to the **yes-no** pattern. Add a pattern reference for consistency:
```
**Ask the user** using the **yes-no** pattern from `skills/shared/gate-prompts.md`:
  question: "I'm not sure about the best approach for {topic}. Research it now?"
  options:
    - label: "Research now"   description: "Spawn a researcher agent to investigate"
    - label: "Save for later" description: "Add as a research question for future investigation"
```

5. Verify the context pressure awareness (line 141-145) stays as plain text — "Want to wrap up with outputs, or keep going?" is conversational bridging, not a structured decision. Do NOT convert this to AskUserQuestion.
  </action>
  <verify>
grep "AskUserQuestion" plugins/dev/skills/explore/SKILL.md
grep "output-routing\|yes-no" plugins/dev/skills/explore/SKILL.md
grep -c "pattern" plugins/dev/skills/explore/SKILL.md
  </verify>
  <done>explore SKILL.md uses output-routing pattern for Step 3 confirmation, yes-no pattern for mid-conversation research decision, and preserves freeform Socratic conversation elements</done>
</task>
