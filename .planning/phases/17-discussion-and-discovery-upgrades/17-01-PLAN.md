---
phase: "17-discussion-and-discovery-upgrades"
plan: "17-01"
type: "feature"
wave: 1
depends_on: []
files_modified:
  - "plugins/dev/skills/shared/gate-prompts.md"
  - "plugins/dev/skills/begin/SKILL.md"
autonomous: true
dependency_fingerprints:
  "16-01": "len:2747-mod:2026-02-10T23:49"
  "16-02": "len:3535-mod:2026-02-10T23:50"
  "16-03": "len:3080-mod:2026-02-10T23:50"
discovery: 0
must_haves:
  truths:
    - "gate-prompts.md contains 7 new patterns for discussion and discovery skills"
    - "begin SKILL.md workflow preferences use AskUserQuestion with pattern references"
    - "begin SKILL.md depth selection uses AskUserQuestion with quick/standard/comprehensive options"
    - "begin SKILL.md research decision and commit confirmation use yes-no pattern"
    - "begin SKILL.md roadmap approval uses approve-revise-abort pattern"
    - "begin SKILL.md has AskUserQuestion in allowed-tools"
  artifacts:
    - "plugins/dev/skills/shared/gate-prompts.md (7 new patterns added)"
    - "plugins/dev/skills/begin/SKILL.md (4 conversion points updated)"
  key_links:
    - "begin SKILL.md references depth-select pattern by name"
    - "begin SKILL.md references git-strategy-select pattern by name"
    - "begin SKILL.md references yes-no pattern for 2-option confirmations"
    - "begin SKILL.md references approve-revise-abort pattern for roadmap gate"
---

# Plan 17-01: Gate Prompt Patterns + Begin Skill Conversions

Add 7 new AskUserQuestion patterns to gate-prompts.md and convert all 4 conversion points in the begin SKILL.md to use structured AskUserQuestion calls.

## Pattern Reuse Analysis

Several begin conversion points reuse existing patterns rather than needing new ones:
- **Mode (interactive/autonomous)**: reuse `toggle-confirm` with custom labels
- **Parallelization (enabled/disabled)**: reuse `toggle-confirm` with custom labels
- **Commit docs (yes/no)**: reuse `yes-no` pattern
- **Research decision (yes/no)**: reuse `yes-no` pattern
- **Commit confirmation (yes/no)**: reuse `yes-no` pattern
- **Roadmap approval**: reuse `approve-revise-abort` pattern

New patterns needed only for: depth-select (3 options), git-strategy-select (3 options), plus 5 patterns for other skills (context-handling, gray-area-option, output-routing, debug-session-select, debug-checkpoint).

---

<task id="17-01-T1" type="auto" tdd="false">
  <name>Add 7 new AskUserQuestion patterns to gate-prompts.md</name>
  <files>
    plugins/dev/skills/shared/gate-prompts.md
  </files>
  <action>
1. Read `plugins/dev/skills/shared/gate-prompts.md`
2. Update the reference header (line 3) to add begin, discuss, explore, debug to the "Referenced by" list
3. Append the following 7 new patterns after the existing `scope-confirm` pattern (after line 263), each separated by `---`:

**Pattern 1: depth-select**
- Purpose: 3-option depth selection for begin skill workflow preferences
- header: "Depth" (5 chars)
- options: Quick ("3-5 phases, skip research, ~50% cheaper"), Standard ("5-8 phases with research (default)"), Comprehensive ("8-12 phases, deep research, ~2x cost")
- multiSelect: false

**Pattern 2: git-strategy-select**
- Purpose: 3-option git branching strategy for begin skill
- header: "Git"  (3 chars)
- options: None ("Commit to current branch (default)"), Phase branches ("Create a branch per phase"), Milestone branches ("Create a branch per milestone")
- multiSelect: false

**Pattern 3: context-handling**
- Purpose: 3-option handler for existing CONTEXT.md in discuss skill
- header: "Context" (7 chars)
- question: "Phase {N} already has a CONTEXT.md. How should we handle it?"
- options: Overwrite ("Replace with new decisions"), Append ("Add new decisions below existing ones"), Cancel ("Keep existing and stop")
- multiSelect: false

**Pattern 4: gray-area-option**
- Purpose: Dynamic template for presenting gray area choices in discuss skill
- header: "Decision" (8 chars)
- question: "{Gray area title}"
- options: dynamically generated 2-4 concrete options from analysis, plus always include "Let Claude decide" as the last option with description "Mark as Claude's Discretion"
- multiSelect: false
- Note: Add a note that options are generated at runtime based on phase analysis. The pattern defines the structure; the skill fills in options per gray area. If >4 options identified, split into 2-step flow.

**Pattern 5: output-routing**
- Purpose: 4-option confirmation for explore skill output proposals
- header: "Outputs" (7 chars)
- question: "How do you want to handle these proposed outputs?"
- options: Approve all ("Create all suggested artifacts"), Adjust ("Modify the proposals before creating"), Add more ("I have additional outputs to capture"), Skip ("Don't create any artifacts from this session")
- multiSelect: false

**Pattern 6: debug-session-select**
- Purpose: Dynamic template for debug session selection
- header: "Debug" (5 chars)
- question: "Found active debug sessions. Which would you like?"
- options: dynamically generated from active sessions (label: "#{NNN}: {title}", description: "Started {date}, last: {hypothesis}"), plus always include "New session" as the last option with description "Start a fresh debug investigation"
- multiSelect: false
- Note: Add a note that if >3 active sessions exist, show the 3 most recent plus "New session" (max 4 options). Older sessions can be accessed by running `/dev:debug` with the session number.

**Pattern 7: debug-checkpoint**
- Purpose: 3-option checkpoint response during debug investigation
- header: "Continue?" (9 chars)
- question: "Investigation has reached a checkpoint. How should we proceed?"
- options: Continue ("Keep investigating with current findings"), More info ("I have additional context to share"), New approach ("Try a different investigation angle")
- multiSelect: false

4. Ensure each pattern follows the exact formatting convention of existing patterns (code block with Use AskUserQuestion, proper indentation, notes after code block where applicable)
  </action>
  <verify>
grep -c "^## Pattern:" plugins/dev/skills/shared/gate-prompts.md
grep "depth-select\|git-strategy-select\|context-handling\|gray-area-option\|output-routing\|debug-session-select\|debug-checkpoint" plugins/dev/skills/shared/gate-prompts.md
grep "begin, discuss, explore, debug" plugins/dev/skills/shared/gate-prompts.md
  </verify>
  <done>gate-prompts.md contains 21 total patterns (14 existing + 7 new), all with headers under 12 characters and multiSelect: false</done>
</task>

<task id="17-01-T2" type="auto" tdd="false">
  <name>Convert begin SKILL.md Step 3 workflow preferences to AskUserQuestion</name>
  <files>
    plugins/dev/skills/begin/SKILL.md
  </files>
  <action>
1. Read `plugins/dev/skills/begin/SKILL.md`
2. Add `AskUserQuestion` to the `allowed-tools` frontmatter (line 4). Result: `allowed-tools: Read, Write, Bash, Glob, Grep, WebFetch, WebSearch, Task, AskUserQuestion`
3. Rewrite Step 3 (lines 94-133) to use explicit AskUserQuestion calls for each preference. Replace the current "Ask:" format with pattern references. The 5 preferences become 5 sequential AskUserQuestion calls:

**3a. Mode** (lines 98-101):
Replace the "Ask:" text with:
```
Use the **toggle-confirm** pattern from `skills/shared/gate-prompts.md`:
  question: "How do you want to work?"
  header: "Mode"
  options:
    - label: "Interactive"  description: "Pause at key gates for your approval (default)"
    - label: "Autonomous"   description: "Auto-proceed, only stop for critical decisions"
```
Keep the bullet explanations of interactive vs autonomous below.

**3b. Depth** (lines 103-107):
Replace the "Ask:" text with:
```
Use the **depth-select** pattern from `skills/shared/gate-prompts.md`:
  question: "How thorough should planning be?"
```
Keep the bullet explanations of quick/standard/comprehensive below.

**3c. Parallelization** (lines 109-111):
Replace the "Ask:" text with:
```
Use the **toggle-confirm** pattern from `skills/shared/gate-prompts.md`:
  question: "Run multiple agents in parallel when plans are independent?"
  header: "Parallel"
  options:
    - label: "Enable"   description: "Parallel execution of independent plans (default)"
    - label: "Disable"  description: "Sequential execution only"
```

**3d. Git Branching** (lines 114-118):
Replace the "Ask:" text with:
```
Use the **git-strategy-select** pattern from `skills/shared/gate-prompts.md`:
  question: "Git branching strategy?"
```
Keep the bullet explanations below.

**3e. Commit Planning Docs** (lines 120-123):
Replace the "Ask:" text with:
```
Use the **yes-no** pattern from `skills/shared/gate-prompts.md`:
  question: "Should planning documents (.planning/ directory) be committed to git?"
  options:
    - label: "Yes"  description: "Commit planning docs (default)"
    - label: "No"   description: "Add .planning/ to .gitignore"
```

4. Add a bridging note at the top of Step 3 (after line 96):
```
Present each preference as a separate AskUserQuestion call. Add brief conversational bridging between calls (e.g., "Great. Next...") to keep the flow natural.
```

5. Update the introductory line (line 96) from "Use AskUserQuestion or direct conversation to determine:" to "Use AskUserQuestion for each preference below. Present them sequentially with conversational bridging:"
  </action>
  <verify>
grep "AskUserQuestion" plugins/dev/skills/begin/SKILL.md | head -20
grep "depth-select\|git-strategy-select\|toggle-confirm\|yes-no" plugins/dev/skills/begin/SKILL.md
grep "allowed-tools.*AskUserQuestion" plugins/dev/skills/begin/SKILL.md
  </verify>
  <done>begin SKILL.md Step 3 uses 5 sequential AskUserQuestion calls with pattern references for workflow preferences, and AskUserQuestion is in allowed-tools</done>
</task>

<task id="17-01-T3" type="auto" tdd="false">
  <name>Convert begin SKILL.md Steps 4, 8, and 10b to AskUserQuestion</name>
  <files>
    plugins/dev/skills/begin/SKILL.md
  </files>
  <action>
1. Read `plugins/dev/skills/begin/SKILL.md` (post-T2 state)

2. **Step 4 research decision** (around lines 153-156):
Replace the current "Ask:" line with:
```
Use the **yes-no** pattern from `skills/shared/gate-prompts.md`:
  question: "I'd like to research the technology landscape before planning. This helps create better plans. Proceed with research?"
  options:
    - label: "Yes"  description: "Run research agents (recommended for standard/comprehensive)"
    - label: "No"   description: "Skip research, move straight to requirements"
```
Keep the "If no: skip to Step 7" / "If yes: proceed to Step 5" logic.

3. **Step 8 roadmap approval** (around lines 318-321):
Replace the implicit approval flow with:
```
If `gates.confirm_roadmap` is true in config, use the **approve-revise-abort** pattern from `skills/shared/gate-prompts.md`:
  question: "Approve this roadmap?"
  options:
    - label: "Approve"          description: "Proceed with this roadmap"
    - label: "Request changes"  description: "Discuss adjustments before proceeding"
    - label: "Abort"            description: "Cancel and start over"
```
Keep the existing "If user requests changes" / "If user approves" logic.

4. **Step 10b commit confirmation** (around lines 406-410):
Replace the current "Ask:" line with:
```
Use the **yes-no** pattern from `skills/shared/gate-prompts.md`:
  question: "Everything look good? Commit the planning docs?"
  options:
    - label: "Yes"  description: "Stage and commit .planning/ files"
    - label: "No"   description: "Let me review and adjust first"
```
Keep the existing "If yes" / "If no" logic.

5. Verify that no "Ask:" lines remain in the skill that should be AskUserQuestion. The remaining "Ask:" usage in Step 1 (brownfield detection, line 46: "Would you like to run /dev:scan first?") and Step 1 (.planning/ exists, line 52: "This will overwrite it. Continue?") are legitimate simple yes/no questions that could use the yes-no pattern. Convert these too:

**Step 1 brownfield** (line 46):
Replace with:
```
Use the **yes-no** pattern:
  question: "This looks like an existing codebase. Run /dev:scan to analyze what's here first?"
  options:
    - label: "Yes, scan"   description: "Run /dev:scan first to analyze existing code"
    - label: "No, begin"   description: "Proceed with /dev:begin on top of existing code"
```

**Step 1 overwrite** (line 52):
Replace with:
```
Use the **yes-no** pattern:
  question: "A .planning/ directory already exists. This will overwrite it. Continue?"
  options:
    - label: "Yes"  description: "Overwrite existing planning directory"
    - label: "No"   description: "Cancel â€” keep existing planning"
```
  </action>
  <verify>
grep -c "AskUserQuestion\|yes-no\|approve-revise-abort\|depth-select\|git-strategy-select\|toggle-confirm" plugins/dev/skills/begin/SKILL.md
grep -n "^- Ask:" plugins/dev/skills/begin/SKILL.md || echo "No bare Ask: lines remain (good)"
  </verify>
  <done>begin SKILL.md uses AskUserQuestion with pattern references for all decision points: brownfield detection, overwrite confirmation, depth selection, mode, parallelization, git strategy, commit docs, research decision, roadmap approval, and commit confirmation</done>
</task>
