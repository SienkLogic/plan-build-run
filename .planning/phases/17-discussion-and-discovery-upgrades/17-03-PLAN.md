---
phase: "17-discussion-and-discovery-upgrades"
plan: "17-03"
type: "feature"
wave: 2
depends_on: ["17-01"]
files_modified:
  - "plugins/dev/skills/debug/SKILL.md"
autonomous: true
dependency_fingerprints:
  "16-01": "len:2747-mod:2026-02-10T23:49"
  "16-02": "len:3535-mod:2026-02-10T23:50"
  "16-03": "len:3080-mod:2026-02-10T23:50"
discovery: 0
must_haves:
  truths:
    - "debug SKILL.md uses AskUserQuestion for active session selection with debug-session-select pattern"
    - "debug SKILL.md uses AskUserQuestion for checkpoint responses with debug-checkpoint pattern"
    - "debug SKILL.md has AskUserQuestion in allowed-tools"
    - "debug SKILL.md symptom gathering remains freeform text (NOT AskUserQuestion)"
    - "All existing tests pass after all Phase 17 changes"
  artifacts:
    - "plugins/dev/skills/debug/SKILL.md (2 conversion points updated, 1 false positive corrected)"
  key_links:
    - "debug SKILL.md references debug-session-select pattern by name"
    - "debug SKILL.md references debug-checkpoint pattern by name"
---

# Plan 17-03: Debug Skill Conversion + Phase Verification

Convert the debug skill to use AskUserQuestion for session selection and checkpoint responses. Correct the false positive in symptom gathering (currently says "use AskUserQuestion" but these are freeform text questions). Run full test suite to verify no regressions across all Phase 17 changes.

## False Positive: Symptom Gathering

The debug SKILL.md line 79 says "use AskUserQuestion for each" for symptom gathering questions. This is WRONG — symptom questions (expected behavior, actual behavior, reproduction, onset, scope) require freeform text answers, not option selection. This plan corrects that wording.

---

<task id="17-03-T1" type="auto" tdd="false">
  <name>Convert debug SKILL.md to use AskUserQuestion for structured decisions</name>
  <files>
    plugins/dev/skills/debug/SKILL.md
  </files>
  <action>
1. Read `plugins/dev/skills/debug/SKILL.md`
2. Add `AskUserQuestion` to the `allowed-tools` frontmatter (line 5). Result: `allowed-tools: Read, Write, Edit, Bash, Glob, Grep, Task, AskUserQuestion`

3. **Step 1 active session selection** (lines 50-63):
Replace the current numbered list presentation with an explicit pattern reference. Replace lines 50-63:

```
**If active sessions found:**

Use the **debug-session-select** pattern from `skills/shared/gate-prompts.md`:
  question: "Found active debug sessions. Which would you like?"

Generate options dynamically from active sessions:
- Each active session becomes an option: label "#{NNN}: {title}", description "Started {date}, last: {last hypothesis}"
- Always include "New session" as the last option: description "Start a fresh debug investigation"
- If more than 3 active sessions exist, show only the 3 most recent plus "New session" (max 4 options)

Handle responses:
- If user selects an existing session: go to **Resume Flow** (Step 2b)
- If user selects "New session": go to **New Session Flow** (Step 2a)
- If user types a session number not in the list: look it up and resume it
```

4. **Step 2a symptom gathering** (lines 78-91):
FIX THE FALSE POSITIVE. Replace line 79:
From: `**Symptom gathering questions** (use AskUserQuestion for each):`
To: `**Symptom gathering questions** (ask as plain text — these are freeform, do NOT use AskUserQuestion):`

The 5 symptom questions (Expected behavior, Actual behavior, Reproduction, Onset, Scope) all require freeform text answers. They stay as conversational questions. No AskUserQuestion.

5. **Step 3 checkpoint response** (lines 236-240):
Replace the current text with an explicit pattern reference:

```
3. Use the **debug-checkpoint** pattern from `skills/shared/gate-prompts.md`:
   question: "Investigation has reached a checkpoint. How should we proceed?"

Handle responses:
- "Continue": Spawn another `Task(subagent_type: "dev:towline-debugger")` with updated context from the debug file
- "More info": Ask the user freeform what additional context they have, then update the debug file and spawn another debugger
- "New approach": Ask the user freeform what alternative angle to try, then update hypotheses and spawn another debugger
```

Remove the old numbered list format (lines 237-239: "Continue investigating?", "Provide additional information?", "Try a different approach?") and replace with the pattern reference above.

6. Verify that the remaining AskUserQuestion references in the file are either:
   - The session selection (Step 1) — converted above
   - The checkpoint response (Step 3) — converted above
   - NOT the symptom gathering (Step 2a) — corrected above
  </action>
  <verify>
grep "AskUserQuestion" plugins/dev/skills/debug/SKILL.md
grep "allowed-tools.*AskUserQuestion" plugins/dev/skills/debug/SKILL.md
grep "debug-session-select\|debug-checkpoint" plugins/dev/skills/debug/SKILL.md
grep -n "freeform" plugins/dev/skills/debug/SKILL.md
  </verify>
  <done>debug SKILL.md has AskUserQuestion in allowed-tools, uses debug-session-select pattern for session selection, debug-checkpoint pattern for checkpoint responses, and symptom gathering is explicitly marked as freeform (not AskUserQuestion)</done>
</task>

<task id="17-03-T2" type="auto" tdd="false">
  <name>Run full test suite and validate all Phase 17 changes</name>
  <files>
  </files>
  <action>
1. Run the full test suite to check for regressions:
   ```
   cd D:\Repos\towline && npm test
   ```

2. Run the plugin validation:
   ```
   cd D:\Repos\towline && npm run validate
   ```

3. Run lint:
   ```
   cd D:\Repos\towline && npm run lint
   ```

4. Verify all 4 converted skills have AskUserQuestion in allowed-tools:
   ```
   grep "allowed-tools" plugins/dev/skills/begin/SKILL.md plugins/dev/skills/discuss/SKILL.md plugins/dev/skills/explore/SKILL.md plugins/dev/skills/debug/SKILL.md
   ```

5. Verify gate-prompts.md has all 21 patterns (14 existing + 7 new):
   ```
   grep -c "^## Pattern:" plugins/dev/skills/shared/gate-prompts.md
   ```

6. Verify no freeform elements were accidentally converted to AskUserQuestion:
   - debug symptom gathering says "freeform" or "do NOT use AskUserQuestion"
   - explore Socratic conversation is unchanged
   - discuss open exploration (Step 2.5) is unchanged
   - discuss follow-up questions 2 and 3 (quality level, integration) remain freeform

7. If any test fails, investigate and fix. The changes in this phase are purely to SKILL.md files (markdown prompts) and gate-prompts.md (markdown patterns), so test failures would indicate a structural issue in the markdown that a hook script validates.
  </action>
  <verify>
npm test --prefix D:/Repos/towline 2>&1 | tail -5
npm run validate --prefix D:/Repos/towline 2>&1 | tail -3
  </verify>
  <done>All existing tests pass, plugin validation succeeds, lint passes, and all 4 skills correctly use AskUserQuestion for structured decisions while preserving freeform elements</done>
</task>
