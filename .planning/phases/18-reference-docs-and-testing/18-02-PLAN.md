---
phase: "18-reference-docs-and-testing"
plan: "18-02"
type: "docs"
wave: 1
depends_on: []
files_modified:
  - "references/DEVELOPMENT-GUIDE.md"
autonomous: true
dependency_fingerprints:
  "17-01": "len:3624-mod:2026-02-10T20:16"
  "17-02": "len:4170-mod:2026-02-10T20:19"
  "17-03": "len:3831-mod:2026-02-10T20:19"
discovery: 0
must_haves:
  truths:
    - "DEVELOPMENT-GUIDE.md documents AskUserQuestion conventions for skill authors"
    - "DEVELOPMENT-GUIDE.md references the gate-prompts.md pattern catalog"
    - "DEVELOPMENT-GUIDE.md explains when NOT to use AskUserQuestion"
  artifacts:
    - "references/DEVELOPMENT-GUIDE.md (updated with AskUserQuestion subsection in Skill Authoring Patterns)"
  key_links:
    - "DEVELOPMENT-GUIDE.md Gate Check Pattern subsection references AskUserQuestion as the implementation mechanism"
    - "DEVELOPMENT-GUIDE.md references skills/shared/gate-prompts.md for reusable patterns"
---

# Plan 18-02: Update DEVELOPMENT-GUIDE.md with AskUserQuestion Conventions

<objective>
Add AskUserQuestion documentation to the DEVELOPMENT-GUIDE.md so that skill authors
understand the structured prompt conventions, pattern catalog, and when to use
plain conversation instead.
</objective>

<tasks>

<task id="18-02-T1" type="auto" tdd="false">
  <name>Add AskUserQuestion conventions to Skill Authoring Patterns section</name>
  <files>
    references/DEVELOPMENT-GUIDE.md
  </files>
  <action>
1. Read `references/DEVELOPMENT-GUIDE.md` starting at the "Skill Authoring Patterns"
   section (line 1836).

2. Locate the "Gate Check Pattern" subsection (line 1924). This subsection currently
   describes gate checks using plain-text "Ask user: Approve?" prompts. Update this
   subsection to document AskUserQuestion as the implementation mechanism.

3. Replace the existing "Gate Check Pattern" subsection content (lines 1924-1937) with
   the following updated version:

```markdown
### Gate Check Pattern

When a gate is configured, use AskUserQuestion for structured prompts:

```markdown
### Step N: Gate Check

If `gates.confirm_{gate_name}` is true:
1. Display {summary of what will happen}
2. Use AskUserQuestion with the appropriate pattern from `skills/shared/gate-prompts.md`:
   - `approve-revise-abort` for plan/roadmap approval
   - `yes-no` for simple confirmations (re-plan, rebuild, commit)
   - `multi-option-failure` for build failure handling
   - `multi-option-escalation` for review escalation
3. Handle the selected option:
   - Approval options: proceed to next step
   - Rejection/abort options: stop and report
   - "Request changes" options: enter discussion flow
   - Freeform text (user typed instead of selecting): treat as feedback
```

**Important**: AskUserQuestion is orchestrator-only. It cannot be called from
subagent Task() contexts. Gates always run in the orchestrator.
```

4. After the updated "Gate Check Pattern" subsection, insert a new subsection
   **"AskUserQuestion Conventions"** (before "Subagent Spawning Pattern" at line 1939):

```markdown
### AskUserQuestion Conventions

Towline uses `AskUserQuestion` for all structured user decision points. This tool
replaced the earlier plain-text "Type approved" / "Type continue" prompts in
Phases 15-17.

**Pattern catalog**: All reusable prompt patterns live in `skills/shared/gate-prompts.md`
(21 patterns as of Phase 17). Skills reference patterns by name rather than
defining prompts inline.

**Rules**:
- Max 4 options per call (AskUserQuestion limit)
- `header` max 12 characters (single word preferred)
- `multiSelect: false` always (Towline gates require single selection)
- Always handle the "Other" case (user typed freeform text)
- Orchestrator-only: cannot be called from subagent Task() contexts

**When to use AskUserQuestion**:
- Gate checks (approve/reject/revise)
- Configuration menus (category selection, toggle confirmation)
- Action routing (suggest next command from options)
- Workflow preferences (depth, git strategy, etc.)
- Debug checkpoints (continue/more info/new approach)

**When NOT to use AskUserQuestion**:
- Freeform text input (task descriptions, symptom gathering)
- Socratic discussion (explore conversations, discuss follow-ups)
- Open-ended questions with unbounded response space
- Subagent contexts (agents cannot call AskUserQuestion)

**Adding a new pattern**:
1. Check `skills/shared/gate-prompts.md` for an existing pattern that fits
2. If no match, add a new `## Pattern: {slug}` section to gate-prompts.md
3. Follow the structure: question template, header (max 12 chars), 2-4 options, multiSelect: false
4. Add the skill name to the "Used by" list in the pattern
5. Reference the pattern by name in the SKILL.md

**Example** (from build skill, failure handling):
```
Use AskUserQuestion with the **multi-option-failure** pattern from gate-prompts.md:
  question: "Plan 03-02 failed. How should we proceed?"
  header: "Failed"
  options:
    - label: "Retry"     description: "Re-run this plan's executor"
    - label: "Skip"      description: "Mark as skipped, continue to next wave"
    - label: "Rollback"  description: "Undo commits, revert to last good state"
    - label: "Abort"     description: "Stop the entire build"
```

**Skills using AskUserQuestion** (17 of 21):
begin, build, config, debug, discuss, explore, import, milestone, plan, quick,
resume, review, scan, setup, status, note, todo

**Skills intentionally excluded** (4 of 21):
continue (fully automated), health (read-only), help (read-only), pause (no interaction)

Note: `note` and `todo` list AskUserQuestion in allowed-tools but do not currently
use it. This is acceptable -- allowed-tools lists capabilities, not requirements.
```

5. Verify the section flows correctly into the existing "Subagent Spawning Pattern"
   subsection that follows.
  </action>
  <verify>
    node -e "const c=require('fs').readFileSync('references/DEVELOPMENT-GUIDE.md','utf8'); const a=(c.match(/AskUserQuestion/g)||[]).length; const s=c.includes('AskUserQuestion Conventions'); const g=(c.match(/gate-prompts\.md/g)||[]).length; console.log('AskUserQuestion:', a, '| Section:', s, '| gate-prompts refs:', g); if(a<10||!s||g<2) process.exit(1);"
  </verify>
  <done>
    DEVELOPMENT-GUIDE.md contains an "AskUserQuestion Conventions" subsection within
    Skill Authoring Patterns, documenting usage rules, the pattern catalog reference,
    when-to-use/when-not-to-use guidance, how to add new patterns, and the skill
    coverage breakdown.
  </done>
</task>

<task id="18-02-T2" type="auto" tdd="false">
  <name>Update Gate Check Pattern example in Decision Points section</name>
  <files>
    references/DEVELOPMENT-GUIDE.md
  </files>
  <action>
1. Read `references/DEVELOPMENT-GUIDE.md` at the "Decision Points" section (line 739).

2. Locate the "Config-Driven Branches" subsection. The gate toggle entries (lines 770-784)
   currently describe gates generically as "pauses for user approval". These are accurate
   as-is since they describe config behavior, not implementation. No changes needed here.

3. Locate the "State-Driven Branches" subsection (line 802). Check if any branch
   descriptions reference the old "Type approved" pattern. If they do, update them
   to reference AskUserQuestion. If they describe state logic only (which is expected),
   no changes needed.

4. Scroll to the existing "Gate Check Pattern" description in the Orchestration Flow
   Pattern subsection (line 1907-1916). The example shows:
   ```
   3. Ask: "Approve?"
   4. If user says "yes" / "approved" / "looks good": proceed
   ```
   Update this to reference AskUserQuestion:
   ```
   3. Use AskUserQuestion (approve-revise-abort pattern)
   4. If user selects "Approve": proceed
   5. If user selects "Request changes": enter discussion
   6. If user selects "Abort": stop and report
   ```

5. Verify the Orchestration Flow Pattern step numbering is consistent after the edit.
  </action>
  <verify>
    node -e "const c=require('fs').readFileSync('references/DEVELOPMENT-GUIDE.md','utf8'); const old=(c.match(/Ask:.*Approve/g)||[]).length; const nu=c.includes('approve-revise-abort'); console.log('Old Ask:Approve refs:', old, '| approve-revise-abort present:', nu); if(old>0||!nu) process.exit(1);"
  </verify>
  <done>
    The Orchestration Flow Pattern example in DEVELOPMENT-GUIDE.md references
    AskUserQuestion (approve-revise-abort pattern) instead of the old plain-text
    "Ask: Approve?" pattern. No stale plain-text gate examples remain outside
    of intentional freeform cases.
  </done>
</task>

</tasks>
