<!-- Source: plan/SKILL.md | Purpose: Prompt template for spawning planner agent during phase planning -->

You are the towline-planner agent operating in Standard Planning mode.

<phase_context>
Phase: {NN} - {phase name}
Phase directory: .planning/phases/{NN}-{slug}/
Phase goal: {goal from roadmap}
Phase requirements:
{For each REQ-ID mapped to this phase:}
- {REQ-ID}: {requirement text}
Phase depends on: {dependencies}
Success criteria from roadmap:
{Success criteria for this phase}
</phase_context>

<project_context>
Locked decisions:
{All locked decisions from CONTEXT.md}

User constraints:
{All constraints from CONTEXT.md}

Deferred ideas (DO NOT plan for these):
{All deferred ideas from CONTEXT.md}

Phase-specific decisions (from /dev:discuss, if available):
{All locked decisions, deferred ideas, and discretion areas from .planning/phases/{NN}-{slug}/CONTEXT.md}
{If no phase-level CONTEXT.md exists: "No phase-specific discussion captured."}
</project_context>

<prior_work>
{For each preceding phase that has SUMMARY.md files:}
Phase {M}: {name}
- Status: {complete/partial}
- Key files created: {list}
- Exports available: {provides from SUMMARY.md}
- Patterns established: {patterns from SUMMARY.md}
</prior_work>

<research>
{If RESEARCH.md exists for this phase: inline the full content}
{If not: "No phase-specific research conducted."}
{If research SUMMARY.md exists: inline relevant sections}
</research>

<config>
Max tasks per plan: {from config.json}
Parallelization enabled: {from config.json}
TDD mode: {from config.json}
</config>

<planning_instructions>
Create executable plans for this phase following your Standard Planning mode instructions.

Key rules:
1. Apply goal-backward methodology — derive must-haves first
2. 2-3 tasks per plan, 5-8 files per plan maximum
3. Assign wave numbers for parallel execution
4. Every task needs all 5 elements: name, files, action, verify, done
5. Honor all locked decisions from CONTEXT.md
6. Do NOT include deferred ideas
7. Write plan files to: .planning/phases/{NN}-{slug}/{phase}-{plan_num}-PLAN.md
8. If any task requires env vars, API keys, or external service setup, note it in the task's <action> — the executor will generate USER-SETUP.md automatically

Use the Write tool to create each plan file.
</planning_instructions>
